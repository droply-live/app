{% extends "base_signed_in.html" %}

{% block title %}Profile Editor - Droply{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/profile-editor.css') }}">
{% endblock %}

{% block content %}
<div class="profile-editor-container">
    <div class="profile-editor-layout">
        <!-- Left Side: Tabbed Form Interface -->
        <div class="profile-editor-left">
            <div style="padding: 1rem; color: white; font-weight: bold; background: rgba(16, 185, 129, 0.2);">
                LEFT PANEL - FORM INTERFACE
            </div>
            <div class="profile-editor-panel">
                <!-- Tab Navigation -->
                <div class="tab-navigation">
                    <button class="tab-btn active" onclick="switchTab('basic')">
                        <i class="fas fa-user"></i>
                        <span>Basic Info</span>
                    </button>
                    <button class="tab-btn" onclick="switchTab('appearance')">
                        <i class="fas fa-palette"></i>
                        <span>Appearance</span>
                    </button>
                    <button class="tab-btn" onclick="switchTab('content')">
                        <i class="fas fa-folder"></i>
                        <span>Content</span>
                    </button>
                </div>

                <!-- Tab Content -->
                <div class="tab-content">
                        <!-- Basic Info Tab -->
                        <div id="basic-tab" class="tab-panel active">
                            <!-- Profile Images Section -->
                            <div class="section">
                                <div class="section-header">
                                    <div class="section-icon">
                                        <i class="fas fa-image"></i>
                                    </div>
                                    <div class="section-title">
                                        <h3>Profile Images</h3>
                                        <p>Your visual identity</p>
                                    </div>
                                </div>
                                <div class="image-upload-grid">
                                    <div class="image-upload-item">
                                        <label>Profile Picture</label>
                                        <div class="image-upload-area" onclick="document.getElementById('profileImageUpload').click()">
                                            <div class="upload-preview">
                                                {% if current_user.profile_picture %}
                                                    <img id="profileImagePreview" src="{{ current_user.profile_picture }}" alt="Profile">
                                                {% else %}
                                                    <div class="upload-placeholder">
                                                        <i class="fas fa-camera"></i>
                                                        <p>Upload photo</p>
                                                        <small>JPG, PNG up to 5MB</small>
                                                    </div>
                                                {% endif %}
                                            </div>
                                            <input type="file" id="profileImageUpload" accept="image/*" style="display: none;" onchange="handleImageUpload(this)">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Personal Information Section -->
                            <div class="section">
                                <div class="section-header">
                                    <div class="section-icon">
                                        <i class="fas fa-user"></i>
                                    </div>
                                    <div class="section-title">
                                        <h3>Personal Information</h3>
                                        <p>Basic details about yourself</p>
                                    </div>
                                </div>
                                <div class="form-grid">
                                    <div class="form-group">
                                        <label>Full Name</label>
                                        <input type="text" id="fullName" value="{{ current_user.full_name or '' }}" placeholder="Your full name" onchange="updatePreview()">
                                    </div>
                                    <div class="form-group">
                                        <label>Profession/Title</label>
                                        <input type="text" id="profession" value="{{ current_user.profession or '' }}" placeholder="e.g., Software Engineer, Consultant" onchange="updatePreview()">
                                    </div>
                                </div>
                                <div class="form-group full-width">
                                    <label>Bio/About</label>
                                    <textarea id="bio" rows="4" placeholder="Tell us about yourself, your experience, and what you offer..." onchange="updatePreview()">{{ current_user.bio or '' }}</textarea>
                                </div>
                                <div class="form-grid">
                                    <div class="form-group">
                                        <label>Location</label>
                                        <input type="text" id="location" value="{{ current_user.location or '' }}" placeholder="City, Country" onchange="updatePreview()">
                                    </div>
                                    <div class="form-group">
                                        <label>Industry</label>
                                        <input type="text" id="industry" value="{{ current_user.industry or '' }}" placeholder="e.g., Technology, Finance, Healthcare" onchange="updatePreview()">
                                    </div>
                                </div>
                                <div class="form-group full-width">
                                    <label>Expertise Tags</label>
                                    <input type="text" id="expertiseTags" value="{{ current_user.specialty_tags or '' }}" placeholder="e.g., JavaScript, React, Node.js, Python, Machine Learning" onchange="updatePreview()">
                                    <small class="form-hint">Separate tags with commas</small>
                                </div>
                            </div>

                            <!-- Social Media Section -->
                            <div class="section">
                                <div class="section-header">
                                    <div class="section-icon">
                                        <i class="fas fa-share-alt"></i>
                                    </div>
                                    <div class="section-title">
                                        <h3>Social Media Links</h3>
                                        <p>Connect your professional profiles</p>
                                    </div>
                                </div>
                                <div class="social-links-grid">
                                    <div class="social-link-item">
                                        <div class="social-link-header">
                                            <i class="fab fa-linkedin"></i>
                                            <span>LinkedIn</span>
                                        </div>
                                        <input type="url" id="linkedinUrl" value="{{ current_user.linkedin_url or '' }}" onchange="updatePreview()" placeholder="https://linkedin.com/in/yourprofile">
                                    </div>
                                    <div class="social-link-item">
                                        <div class="social-link-header">
                                            <i class="fab fa-twitter"></i>
                                            <span>Twitter</span>
                                        </div>
                                        <input type="url" id="twitterUrl" value="{{ current_user.twitter_url or '' }}" onchange="updatePreview()" placeholder="https://twitter.com/yourhandle">
                                    </div>
                                    <div class="social-link-item">
                                        <div class="social-link-header">
                                            <i class="fab fa-github"></i>
                                            <span>GitHub</span>
                                        </div>
                                        <input type="url" id="githubUrl" value="{{ current_user.github_url or '' }}" onchange="updatePreview()" placeholder="https://github.com/yourusername">
                                    </div>
                                    <div class="social-link-item">
                                        <div class="social-link-header">
                                            <i class="fab fa-instagram"></i>
                                            <span>Instagram</span>
                                        </div>
                                        <input type="url" id="instagramUrl" value="{{ current_user.instagram_url or '' }}" onchange="updatePreview()" placeholder="https://instagram.com/yourhandle">
                                    </div>
                                    <div class="social-link-item">
                                        <div class="social-link-header">
                                            <i class="fab fa-youtube"></i>
                                            <span>YouTube</span>
                                        </div>
                                        <input type="url" id="youtubeUrl" value="{{ current_user.youtube_url or '' }}" onchange="updatePreview()" placeholder="https://youtube.com/c/yourchannel">
                                    </div>
                                    <div class="social-link-item">
                                        <div class="social-link-header">
                                            <i class="fas fa-globe"></i>
                                            <span>Website</span>
                                        </div>
                                        <input type="url" id="websiteUrl" value="{{ current_user.website_url or '' }}" onchange="updatePreview()" placeholder="https://yourwebsite.com">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Appearance Tab -->
                        <div id="appearance-tab" class="tab-panel">
                            <div class="section">
                                <div class="section-header">
                                    <div class="section-icon">
                                        <i class="fas fa-palette"></i>
                                    </div>
                                    <div class="section-title">
                                        <h3>Color Scheme</h3>
                                        <p>Customize your profile's visual appearance</p>
                                    </div>
                                </div>
                                <div class="color-picker-grid">
                                    <div class="color-option">
                                        <label>Primary Color</label>
                                        <div class="color-input-group">
                                            <input type="color" id="primaryColor" value="{{ current_user.primary_color or '#667eea' }}" onchange="updatePreview()">
                                            <input type="text" id="primaryColorText" value="{{ current_user.primary_color or '#667eea' }}" onchange="updateColorFromText('primary')" placeholder="#667eea">
                                        </div>
                                    </div>
                                    <div class="color-option">
                                        <label>Secondary Color</label>
                                        <div class="color-input-group">
                                            <input type="color" id="secondaryColor" value="{{ current_user.secondary_color or '#764ba2' }}" onchange="updatePreview()">
                                            <input type="text" id="secondaryColorText" value="{{ current_user.secondary_color or '#764ba2' }}" onchange="updateColorFromText('secondary')" placeholder="#764ba2">
                                        </div>
                                    </div>
                                    <div class="color-option">
                                        <label>Background Color</label>
                                        <div class="color-input-group">
                                            <input type="color" id="backgroundColor" value="{{ current_user.background_color or '#f7faff' }}" onchange="updatePreview()">
                                            <input type="text" id="backgroundColorText" value="{{ current_user.background_color or '#f7faff' }}" onchange="updateColorFromText('background')" placeholder="#f7faff">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="section">
                                <div class="section-header">
                                    <div class="section-icon">
                                        <i class="fas fa-font"></i>
                                    </div>
                                    <div class="section-title">
                                        <h3>Typography</h3>
                                        <p>Choose your preferred font and size</p>
                                    </div>
                                </div>
                                <div class="form-grid">
                                    <div class="form-group">
                                        <label>Font Family</label>
                                        <select id="fontFamily" onchange="updatePreview()">
                                            <option value="Inter" {{ 'selected' if current_user.font_family == 'Inter' else '' }}>Inter</option>
                                            <option value="Roboto" {{ 'selected' if current_user.font_family == 'Roboto' else '' }}>Roboto</option>
                                            <option value="Open Sans" {{ 'selected' if current_user.font_family == 'Open Sans' else '' }}>Open Sans</option>
                                            <option value="Lato" {{ 'selected' if current_user.font_family == 'Lato' else '' }}>Lato</option>
                                            <option value="Poppins" {{ 'selected' if current_user.font_family == 'Poppins' else '' }}>Poppins</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>Font Size</label>
                                        <div class="range-input">
                                            <input type="range" id="fontSize" min="12" max="20" value="{{ current_user.font_size or 16 }}" onchange="updatePreview()">
                                            <div class="range-value" id="fontSizeValue">{{ current_user.font_size or 16 }}px</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Content Tab -->
                        <div id="content-tab" class="tab-panel">
                            <div class="section">
                                <div class="section-header">
                                    <div class="section-icon">
                                        <i class="fas fa-video"></i>
                                    </div>
                                    <div class="section-title">
                                        <h3>Services</h3>
                                        <p>Configure your consultation offerings</p>
                                    </div>
                                </div>
                                <div class="form-group full-width">
                                    <label>Service Description</label>
                                    <textarea id="serviceDescription" rows="3" placeholder="Describe your 1-on-1 sessions..." onchange="updatePreview()">{{ current_user.service_description or '' }}</textarea>
                                    <small class="form-hint">Explain what clients can expect from your sessions</small>
                                </div>
                                <div class="form-group">
                                    <label>Session Duration (minutes)</label>
                                    <input type="number" id="sessionDuration" value="{{ current_user.session_duration or 30 }}" min="15" max="120" onchange="updatePreview()" placeholder="30">
                                </div>
                            </div>

                            <div class="section">
                                <div class="section-header">
                                    <div class="section-icon">
                                        <i class="fas fa-lock"></i>
                                    </div>
                                    <div class="section-title">
                                        <h3>Premium Content</h3>
                                        <p>Describe your paid content offerings</p>
                                    </div>
                                </div>
                                <div class="form-group full-width">
                                    <label>Content Description</label>
                                    <textarea id="contentDescription" rows="3" placeholder="Describe your premium content offerings..." onchange="updatePreview()">{{ current_user.content_description or '' }}</textarea>
                                    <small class="form-hint">What types of premium content do you offer?</small>
                                </div>
                                <div class="form-group full-width">
                                    <label>Content Categories</label>
                                    <input type="text" id="contentCategories" value="{{ current_user.content_categories or '' }}" placeholder="e.g., Courses, Videos, PDFs, Templates" onchange="updatePreview()">
                                    <small class="form-hint">Separate categories with commas</small>
                                </div>
                            </div>

                            <div class="section">
                                <div class="section-header">
                                    <div class="section-icon">
                                        <i class="fas fa-cog"></i>
                                    </div>
                                    <div class="section-title">
                                        <h3>Settings</h3>
                                        <p>Control your profile visibility and preferences</p>
                                    </div>
                                </div>
                                <div class="checkbox-grid">
                                    <label class="checkbox-item">
                                        <input type="checkbox" id="isAvailable" {{ 'checked' if current_user.is_available else '' }} onchange="updatePreview()">
                                        <div class="checkbox-content">
                                            <span class="checkbox-title">Available for Bookings</span>
                                            <span class="checkbox-desc">Show that you're accepting new clients</span>
                                        </div>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" id="emailNotifications" {{ 'checked' if current_user.email_notifications else '' }} onchange="updatePreview()">
                                        <div class="checkbox-content">
                                            <span class="checkbox-title">Email Notifications</span>
                                            <span class="checkbox-desc">Receive booking and message notifications</span>
                                        </div>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" id="showServices" checked onchange="updatePreview()">
                                        <div class="checkbox-content">
                                            <span class="checkbox-title">Show Services</span>
                                            <span class="checkbox-desc">Display your 1-on-1 sessions</span>
                                        </div>
                                    </label>
                                    <label class="checkbox-item">
                                        <input type="checkbox" id="showContent" checked onchange="updatePreview()">
                                        <div class="checkbox-content">
                                            <span class="checkbox-title">Show Premium Content</span>
                                            <span class="checkbox-desc">Display your paid content</span>
                                        </div>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Side: Live Preview -->
        <div class="profile-editor-right">
            <div style="padding: 1rem; color: white; font-weight: bold; background: rgba(245, 158, 11, 0.2);">
                RIGHT PANEL - LIVE PREVIEW
            </div>
            <div class="preview-panel">
                <!-- Preview Header -->
                <div class="preview-header">
                    <h4>Live Preview</h4>
                    <div class="preview-controls">
                        <button class="preview-btn active" onclick="switchPreview('desktop')">
                            <i class="fas fa-desktop"></i> Desktop
                        </button>
                        <button class="preview-btn" onclick="switchPreview('mobile')">
                            <i class="fas fa-mobile-alt"></i> Mobile
                        </button>
                    </div>
                </div>

                <!-- Preview Container -->
                <div class="preview-container">
                    <div id="desktop-preview" class="preview-frame desktop-preview">
                        <div class="profile-preview" id="profilePreview">
                            <!-- Preview content will be dynamically generated -->
                        </div>
                    </div>
                    <div id="mobile-preview" class="preview-frame mobile-preview" style="display: none;">
                        <div class="profile-preview mobile" id="profilePreviewMobile">
                            <!-- Mobile preview content will be dynamically generated -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="{{ url_for('static', filename='js/profile_editor.js') }}"></script>

<style>
/* Profile Settings Sidebar */
.profile-settings-sidebar {
    background: #1a1a1a;
    border-radius: 12px;
    padding: 1.5rem;
    margin-bottom: 2rem;
    border: 1px solid #333;
}

.sidebar-title {
    color: #ffffff;
    font-size: 1.1rem;
    font-weight: 600;
    margin-bottom: 1rem;
    text-align: center;
}

.settings-nav {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.settings-nav-item {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem 1rem;
    color: #cccccc;
    text-decoration: none;
    border-radius: 8px;
    transition: all 0.2s ease;
    font-size: 0.9rem;
    font-weight: 500;
}

.settings-nav-item:hover {
    background: #2a2a2a;
    color: #ffffff;
}

.settings-nav-item.active {
    background: #10b981;
    color: #ffffff;
}

.settings-nav-item i {
    font-size: 1rem;
    width: 16px;
}

/* Preview Header */
.preview-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem 0;
    margin-bottom: 1rem;
    border-bottom: 1px solid #333;
}

.preview-header h4 {
    color: #ffffff;
    margin: 0;
    font-size: 1.1rem;
    font-weight: 600;
}

.preview-controls {
    display: flex;
    gap: 0.5rem;
}

.preview-controls .btn {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    font-size: 0.875rem;
}

.preview-controls .btn.active {
    background: #10b981;
    border-color: #10b981;
    color: white;
}

/* Tab Content */
.tab-content {
    background: #1a1a1a;
    border-radius: 12px;
    padding: 1.5rem;
    margin-bottom: 2rem;
    border: 1px solid #333;
}

.tab-panel {
    display: none;
}

.tab-panel.active {
    display: block;
}

.section {
    margin-bottom: 2rem;
}

.section:last-child {
    margin-bottom: 0;
}

.section-header {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1.5rem;
}

.section-icon {
    width: 40px;
    height: 40px;
    background: #2a2a2a;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #10b981;
    font-size: 1.125rem;
}

.section-title h3 {
    color: #ffffff;
    font-size: 1.1rem;
    font-weight: 600;
    margin: 0 0 0.25rem 0;
}

.section-title p {
    color: #cccccc;
    font-size: 0.875rem;
    margin: 0;
}

/* Form Styling */
.form-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
    margin-bottom: 1rem;
}

.form-group {
    margin-bottom: 1rem;
}

.form-group.full-width {
    grid-column: 1 / -1;
}

.form-group label {
    display: block;
    color: #ffffff;
    font-weight: 500;
    margin-bottom: 0.5rem;
    font-size: 0.9rem;
}

.form-group input,
.form-group select,
.form-group textarea {
    width: 100%;
    padding: 0.75rem;
    background: #2a2a2a;
    border: 1px solid #404040;
    border-radius: 6px;
    color: #ffffff;
    font-size: 0.9rem;
    transition: border-color 0.2s ease;
}

.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
    outline: none;
    border-color: #10b981;
}

.form-hint {
    color: #9ca3af;
    font-size: 0.8rem;
    margin-top: 0.25rem;
}

/* Preview Section */
.preview-section {
    position: sticky;
    top: 2rem;
    height: fit-content;
}

/* Preview Container */
.preview-container {
    background: #1a1a1a;
    border-radius: 12px;
    padding: 1.5rem;
    border: 1px solid #333;
}

.preview-frame {
    width: 100%;
    border: 1px solid #404040;
    border-radius: 8px;
    overflow: hidden;
    background: white;
}

.desktop-preview {
    min-height: 400px;
}

.mobile-preview {
    max-width: 375px;
    margin: 0 auto;
    min-height: 500px;
}

/* Mobile Responsive Design */
@media (max-width: 768px) {
    .col-md-3 {
        margin-bottom: 1rem;
    }
    
    .profile-settings-sidebar {
        margin-bottom: 1rem;
    }
    
    .col-md-8, .col-md-4 {
        width: 100%;
        margin-bottom: 2rem;
    }
    
    .preview-section {
        position: static;
    }
    
    .preview-header {
        flex-direction: column;
        gap: 1rem;
        text-align: center;
    }
    
    .preview-controls {
        width: 100%;
        justify-content: center;
    }
    
    .form-grid {
        grid-template-columns: 1fr;
    }
    
    .image-upload-grid {
        grid-template-columns: 1fr;
    }
    
    .tab-content {
        padding: 1rem;
    }
    
    .preview-container {
        padding: 1rem;
    }
}

@media (max-width: 480px) {
    .tab-content {
        padding: 0.75rem;
    }
    
    .preview-container {
        padding: 0.75rem;
    }
    
    .preview-controls .btn {
        padding: 0.4rem 0.8rem;
        font-size: 0.8rem;
    }
}

.preview-title h3 {
    margin: 0;
    font-size: 1.125rem;
    font-weight: 600;
    color: #1e293b;
}

.preview-title p {
    margin: 0.25rem 0 0 0;
    font-size: 0.875rem;
    color: #64748b;
}

.preview-controls {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.preview-tabs {
    display: flex;
    background: #f1f5f9;
    border-radius: 8px;
    padding: 0.25rem;
}

.preview-tab {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    border: none;
    background: none;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.2s ease;
    font-size: 0.875rem;
    color: #64748b;
}

.preview-tab.active {
    background: white;
    color: #1e293b;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
}

.preview-action {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    background: #f1f5f9;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
    font-size: 0.875rem;
    color: #64748b;
}

.preview-action:hover {
    background: #e2e8f0;
    color: #374151;
}

.preview-container {
    flex: 1;
    padding: 1.5rem;
    overflow-y: auto;
}

.preview-frame {
    width: 100%;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    overflow: hidden;
    background: white;
}

.desktop-preview {
    min-height: 500px;
}

.mobile-preview {
    max-width: 375px;
    margin: 0 auto;
    min-height: 600px;
}

.profile-preview {
    width: 100%;
    height: 100%;
    background: white;
}

/* Mobile preview styles */
.profile-preview.mobile {
    font-size: 14px;
}

.profile-preview.mobile .profile-header {
    padding: 1rem;
}

.profile-preview.mobile .profile-name {
    font-size: 1.5rem;
}

.profile-preview.mobile .profile-title {
    font-size: 1rem;
}

.tab-panel {
    display: none;
}

.tab-panel.active {
    display: block;
}

.section {
    margin-bottom: 2rem;
}

.section h3 {
    font-size: 1.1rem;
    font-weight: 600;
    margin-bottom: 1rem;
    color: #374151;
}

.form-group {
    margin-bottom: 1.5rem;
}

.form-group label {
    display: block;
    font-weight: 500;
    margin-bottom: 0.5rem;
    color: #374151;
}

.form-group input,
.form-group select,
.form-group textarea {
    width: 100%;
    padding: 0.75rem;
    border: 1px solid #d1d5db;
    border-radius: 6px;
    font-size: 0.9rem;
    transition: border-color 0.2s ease, box-shadow 0.2s ease;
}

.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
    outline: none;
    border-color: #10b981;
    box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
}

.color-picker-group {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.color-option {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.color-input-group {
    display: flex;
    gap: 0.5rem;
}

.color-input-group input[type="color"] {
    width: 50px;
    height: 40px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
}

.color-input-group input[type="text"] {
    flex: 1;
}

.image-upload-area {
    border: 2px dashed #d1d5db;
    border-radius: 8px;
    padding: 2rem;
    text-align: center;
    cursor: pointer;
    transition: all 0.2s;
}

.image-upload-area:hover {
    border-color: #10b981;
    background: #ECFDF5;
}

.upload-preview img {
    max-width: 100%;
    max-height: 200px;
    border-radius: 8px;
}

.upload-placeholder {
    color: #6b7280;
}

.upload-placeholder i {
    font-size: 2rem;
    margin-bottom: 0.5rem;
}

.social-links-grid {
    display: grid;
    gap: 1rem;
}

.social-link-item {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.social-link-item label {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.social-link-item label i {
    width: 20px;
    color: #10b981;
}

.layout-options {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1rem;
}

.layout-option {
    text-align: center;
    cursor: pointer;
    padding: 1rem;
    border: 2px solid #e5e7eb;
    border-radius: 8px;
    transition: all 0.2s;
}

.layout-option:hover {
    border-color: #10b981;
}

.layout-option.selected {
    border-color: #10b981;
    background: #ECFDF5;
}

.layout-preview {
    height: 60px;
    border-radius: 4px;
    margin-bottom: 0.5rem;
}

.modern-layout {
    background: linear-gradient(135deg, #10b981, #047857);
}

.minimal-layout {
    background: linear-gradient(135deg, #f3f4f6, #e5e7eb);
}

.creative-layout {
    background: linear-gradient(135deg, #fbbf24, #f59e0b);
}

.checkbox-group {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.checkbox-group label {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-weight: normal;
}

.preview-panel {
    background: white;
    border-radius: 12px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    overflow: hidden;
}

.preview-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1.5rem;
    border-bottom: 1px solid #e5e7eb;
}

.preview-controls {
    display: flex;
    gap: 0.5rem;
}

.preview-btn {
    padding: 0.5rem;
    border: 1px solid #d1d5db;
    background: white;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.2s;
}

.preview-btn.active {
    background: #10b981;
    color: white;
    border-color: #10b981;
}

/* Button Styles */
.btn-primary, .btn-secondary {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1.5rem;
    border: none;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    text-decoration: none;
}

.btn-primary {
    background: #10b981;
    color: white;
}

.btn-primary:hover {
    background: #047857;
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
}

.btn-secondary {
    background: #f1f5f9;
    color: #64748b;
    border: 1px solid #e2e8f0;
}

.btn-secondary:hover {
    background: #e2e8f0;
    color: #374151;
    transform: translateY(-1px);
}

.preview-container {
    padding: 2rem;
    height: 600px;
    overflow-y: auto;
}

.preview-frame {
    width: 100%;
    height: 100%;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    overflow: hidden;
}

.desktop-preview {
    min-height: 500px;
}

.mobile-preview {
    max-width: 375px;
    margin: 0 auto;
    min-height: 600px;
}

.profile-preview {
    width: 100%;
    height: 100%;
    background: white;
}

/* Mobile preview styles */
.profile-preview.mobile {
    font-size: 14px;
}

.profile-preview.mobile .profile-header {
    padding: 1rem;
}

.profile-preview.mobile .profile-name {
    font-size: 1.5rem;
}

.profile-preview.mobile .profile-title {
    font-size: 1rem;
}

/* Mobile Responsive Design */
@media (max-width: 768px) {
    .editor-layout {
        grid-template-columns: 1fr;
    }
    
    .sidebar-nav {
        display: none;
    }
    
    .main-content {
        width: 100%;
    }
    
    .preview-header-compact {
        flex-direction: column;
        gap: 1rem;
        text-align: center;
    }
    
    .preview-controls {
        width: 100%;
        justify-content: center;
    }
    
    .tab-content {
        padding: 1rem;
    }
    
    .preview-container-compact {
        padding: 1rem;
    }
    
    .form-grid {
        grid-template-columns: 1fr;
    }
    
    .image-upload-grid {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 480px) {
    .tab-content {
        padding: 0.75rem;
    }
    
    .preview-container-compact {
        padding: 0.75rem;
    }
    
    .preview-btn {
        padding: 0.4rem 0.8rem;
        font-size: 0.8rem;
    }
}
</style>

<script>
let currentTab = 'basic';
let currentPreview = 'desktop';
let profileData = {};
let autoSaveTimeout;

// Initialize profile data
function initializeProfileData() {
    profileData = {
        primaryColor: document.getElementById('primaryColor')?.value || '#667eea',
        secondaryColor: document.getElementById('secondaryColor')?.value || '#764ba2',
        backgroundColor: document.getElementById('backgroundColor')?.value || '#f7faff',
        fontFamily: document.getElementById('fontFamily')?.value || 'Inter',
        fontSize: document.getElementById('fontSize')?.value || 16,
        fullName: document.getElementById('fullName')?.value || '{{ current_user.full_name or "Your Name" }}',
        profession: document.getElementById('profession')?.value || '{{ current_user.profession or "Professional" }}',
        bio: document.getElementById('bio')?.value || '{{ current_user.bio or "Tell us about yourself..." }}',
        location: document.getElementById('location')?.value || '{{ current_user.location or "Your Location" }}',
        industry: document.getElementById('industry')?.value || '{{ current_user.industry or "" }}',
        hourlyRate: '{{ current_user.hourly_rate or 0 }}', // From server, not form
        expertiseTags: document.getElementById('expertiseTags')?.value || '{{ current_user.specialty_tags or "" }}',
        linkedinUrl: document.getElementById('linkedinUrl')?.value || '{{ current_user.linkedin_url or "" }}',
        twitterUrl: document.getElementById('twitterUrl')?.value || '{{ current_user.twitter_url or "" }}',
        githubUrl: document.getElementById('githubUrl')?.value || '{{ current_user.github_url or "" }}',
        instagramUrl: document.getElementById('instagramUrl')?.value || '{{ current_user.instagram_url or "" }}',
        youtubeUrl: document.getElementById('youtubeUrl')?.value || '{{ current_user.youtube_url or "" }}',
        websiteUrl: document.getElementById('websiteUrl')?.value || '{{ current_user.website_url or "" }}',
        phone: document.getElementById('phone')?.value || '{{ current_user.phone or "" }}',
        language: document.getElementById('language')?.value || '{{ current_user.language or "en" }}',
        timezone: document.getElementById('timezone')?.value || '{{ current_user.timezone or "UTC" }}',
        isAvailable: document.getElementById('isAvailable')?.checked || true,
        emailNotifications: document.getElementById('emailNotifications')?.checked || true,
        showServices: document.getElementById('showServices')?.checked || true,
        showContent: document.getElementById('showContent')?.checked || true,
        showAbout: document.getElementById('showAbout')?.checked || true,
        showSocial: document.getElementById('showSocial')?.checked || true,
        serviceDescription: document.getElementById('serviceDescription')?.value || '{{ current_user.service_description or "" }}',
        sessionDuration: document.getElementById('sessionDuration')?.value || '{{ current_user.session_duration or 30 }}',
        contentDescription: document.getElementById('contentDescription')?.value || '{{ current_user.content_description or "" }}',
        contentCategories: document.getElementById('contentCategories')?.value || '{{ current_user.content_categories or "" }}'
    };
}

// Tab switching
function switchTab(tabName) {
    // Update nav items
    document.querySelectorAll('.settings-nav-item').forEach(item => item.classList.remove('active'));
    const clickedItem = event.target.closest('.settings-nav-item');
    if (clickedItem) {
        clickedItem.classList.add('active');
    }
    
    // Update tab panels
    document.querySelectorAll('.tab-panel').forEach(panel => panel.classList.remove('active'));
    const targetPanel = document.getElementById(tabName + '-tab');
    if (targetPanel) {
        targetPanel.classList.add('active');
    }
    
    currentTab = tabName;
    
    // Update preview after tab switch
    setTimeout(() => {
        updatePreview();
    }, 50);
}

// Preview switching
function switchPreview(previewType) {
    document.querySelectorAll('.preview-controls .btn').forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');
    
    document.getElementById('desktop-preview').style.display = previewType === 'desktop' ? 'block' : 'none';
    document.getElementById('mobile-preview').style.display = previewType === 'mobile' ? 'block' : 'none';
    
    currentPreview = previewType;
    updatePreview();
}

// Auto-save functionality
function autoSave() {
    clearTimeout(autoSaveTimeout);
    autoSaveTimeout = setTimeout(() => {
        saveProfile(true); // Silent save
    }, 2000); // Save 2 seconds after last change
}

// Update preview
function updatePreview() {
    // Re-initialize profile data to get current form values
    initializeProfileData();
    
    const previewElement = currentPreview === 'mobile' ? 
        document.getElementById('profilePreviewMobile') : 
        document.getElementById('profilePreview');
    
    if (!previewElement) {
        console.error('Preview element not found:', currentPreview === 'mobile' ? 'profilePreviewMobile' : 'profilePreview');
        return;
    }
    
    // Generate and set the preview HTML
    const previewHTML = generatePreviewHTML();
    previewElement.innerHTML = previewHTML;
    previewElement.style.fontFamily = profileData.fontFamily;
    previewElement.style.fontSize = profileData.fontSize + 'px';
    
    // Trigger auto-save
    autoSave();
    
    // Re-render feather icons if they exist
    if (window.feather) {
        feather.replace();
    }
}

// Generate preview HTML - matches real profile exactly
function generatePreviewHTML() {
    const socialLinks = [];
    if (profileData.linkedinUrl) socialLinks.push({name: 'LinkedIn', url: profileData.linkedinUrl, icon: 'fab fa-linkedin'});
    if (profileData.twitterUrl) socialLinks.push({name: 'Twitter', url: profileData.twitterUrl, icon: 'fab fa-twitter'});
    if (profileData.githubUrl) socialLinks.push({name: 'GitHub', url: profileData.githubUrl, icon: 'fab fa-github'});
    if (profileData.instagramUrl) socialLinks.push({name: 'Instagram', url: profileData.instagramUrl, icon: 'fab fa-instagram'});
    if (profileData.youtubeUrl) socialLinks.push({name: 'YouTube', url: profileData.youtubeUrl, icon: 'fab fa-youtube'});
    if (profileData.websiteUrl) socialLinks.push({name: 'Website', url: profileData.websiteUrl, icon: 'fas fa-globe'});
    
    return `
        <div class="container-fluid" style="background: ${profileData.backgroundColor || '#f7faff'}; min-height: 100vh;">
            <div class="row">
                <div class="col-12">
                    <!-- Profile Header -->
                    <div class="profile-header" style="background: linear-gradient(135deg, ${profileData.primaryColor || '#667eea'} 0%, ${profileData.secondaryColor || '#764ba2'} 100%); color: white; padding: 1.5rem 1rem; margin-bottom: 1.5rem; border-radius: 0.5rem;">
                        <div class="row align-items-center">
                            <div class="col-md-3">
                                <div class="profile-avatar text-center">
                                    <img src="${document.getElementById('profileImagePreview')?.src || '/static/img/default-avatar.svg'}" 
                                         alt="Profile Picture" 
                                         class="rounded-circle mb-3 profile-avatar-img" 
                                         style="width: 150px; height: 150px; object-fit: cover;">
                                </div>
                            </div>
                            <div class="col-md-9">
                                <div class="profile-info">
                                    <h1 class="profile-name" style="font-size: 1.75rem; font-weight: 700; margin-bottom: 0.5rem; line-height: 1.3;">${profileData.fullName || 'Your Name'}</h1>
                                    <p class="profile-title" style="font-size: 1rem; opacity: 0.9; margin-bottom: 0.5rem;">${profileData.profession || 'Professional'}</p>
                                    <p class="profile-location" style="font-size: 0.9rem; opacity: 0.8; margin-bottom: 1rem;">
                                        <i class="fas fa-map-marker-alt me-2"></i>${profileData.location || 'Location not specified'}
                                    </p>
                                    
                                    ${profileData.bio ? `
                                    <div class="profile-bio" style="margin-bottom: 1rem; font-size: 0.95rem; line-height: 1.5;">
                                        <p>${profileData.bio}</p>
                                    </div>
                                    ` : ''}
                                    
                                    <div class="profile-stats" style="margin-top: 1rem;">
                                        <div class="row">
                                            <div class="col-md-3">
                                                <div class="stat-item" style="text-align: center; padding: 0.75rem; background: rgba(255, 255, 255, 0.1); border-radius: 0.5rem; margin-bottom: 0.75rem;">
                                                    <h5 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 0.25rem;">4.8</h5>
                                                    <small style="opacity: 0.8;">Rating</small>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="stat-item" style="text-align: center; padding: 0.75rem; background: rgba(255, 255, 255, 0.1); border-radius: 0.5rem; margin-bottom: 0.75rem;">
                                                    <h5 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 0.25rem;">24</h5>
                                                    <small style="opacity: 0.8;">Reviews</small>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="stat-item" style="text-align: center; padding: 0.75rem; background: rgba(255, 255, 255, 0.1); border-radius: 0.5rem; margin-bottom: 0.75rem;">
                                                    <h5 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 0.25rem;">$${profileData.hourlyRate || 0}</h5>
                                                    <small style="opacity: 0.8;">Per Session</small>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="stat-item" style="text-align: center; padding: 0.75rem; background: rgba(255, 255, 255, 0.1); border-radius: 0.5rem; margin-bottom: 0.75rem;">
                                                    <h5 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 0.25rem;">12</h5>
                                                    <small style="opacity: 0.8;">Content Items</small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Navigation Tabs -->
                    <div class="profile-nav" style="margin-bottom: 1.5rem;">
                        <ul class="nav nav-tabs" id="profileTabs" role="tablist" style="border-bottom: 2px solid #e5e7eb;">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" style="border: none; color: ${profileData.primaryColor || '#667eea'}; font-weight: 500; padding: 0.75rem 1rem; border-radius: 0.5rem 0.5rem 0 0; margin-right: 0.5rem; background: #f8fafc; border-bottom: 2px solid ${profileData.primaryColor || '#667eea'};">
                                    <i class="fas fa-video me-2"></i>Services
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" style="border: none; color: #6b7280; font-weight: 500; padding: 0.75rem 1rem; border-radius: 0.5rem 0.5rem 0 0; margin-right: 0.5rem;">
                                    <i class="fas fa-lock me-2"></i>Premium Content
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" style="border: none; color: #6b7280; font-weight: 500; padding: 0.75rem 1rem; border-radius: 0.5rem 0.5rem 0 0; margin-right: 0.5rem;">
                                    <i class="fas fa-user me-2"></i>About
                                </button>
                            </li>
                        </ul>
                    </div>

                    <!-- Tab Content -->
                    <div class="tab-content" id="profileTabContent">
                        <!-- Services Tab -->
                        <div class="tab-pane fade show active" id="services" role="tabpanel">
                            <div class="card" style="background: #fff; border: 1px solid #dee2e6; border-radius: 0.5rem; padding: 1rem; transition: transform 0.2s ease, box-shadow 0.2s ease; height: 100%; margin-bottom: 1rem;">
                                <div class="card-body">
                                    <h5 class="card-title">1-on-1 Sessions</h5>
                                    <p class="card-text">Book a personal session with ${profileData.fullName || 'Your Name'}</p>
                                    
                                    <div class="service-details">
                                        <div class="row">
                                            <div class="col-md-6">
                                                <h6>Session Details</h6>
                                                <ul class="list-unstyled">
                                                    <li><i class="fas fa-clock me-2"></i>Duration: ${profileData.sessionDuration || 30} minutes</li>
                                                    <li><i class="fas fa-dollar-sign me-2"></i>Price: $${profileData.hourlyRate || 0}</li>
                                                    <li><i class="fas fa-video me-2"></i>Video call via platform</li>
                                                </ul>
                                            </div>
                                            <div class="col-md-6">
                                                <h6>What You'll Get</h6>
                                                <ul class="list-unstyled">
                                                    <li><i class="fas fa-check me-2 text-success"></i>Personalized advice</li>
                                                    <li><i class="fas fa-check me-2 text-success"></i>Direct interaction</li>
                                                    <li><i class="fas fa-check me-2 text-success"></i>Follow-up resources</li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="text-center mt-4">
                                        ${profileData.isAvailable ? `
                                            <button class="btn btn-primary btn-lg" style="background: ${profileData.primaryColor || '#667eea'}; border-color: ${profileData.primaryColor || '#667eea'};">
                                                <i class="fas fa-calendar-plus me-2"></i>Book a Session
                                            </button>
                                        ` : `
                                            <button class="btn btn-secondary btn-lg" disabled>
                                                <i class="fas fa-pause me-2"></i>Currently Unavailable
                                            </button>
                                        `}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `;
}

// Color input synchronization
function updateColorFromText(colorType) {
    const textInput = document.getElementById(colorType + 'ColorText');
    const colorInput = document.getElementById(colorType + 'Color');
    colorInput.value = textInput.value;
    // Update preview after color change
    updatePreview();
}

// Image upload handling
function handleImageUpload(input) {
    const file = input.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const preview = document.getElementById('profileImagePreview');
            if (preview) {
                preview.src = e.target.result;
            } else {
                const placeholder = document.querySelector('.upload-placeholder');
                placeholder.innerHTML = `<img src="${e.target.result}" alt="Profile" style="max-width: 100%; max-height: 200px; border-radius: 8px;">`;
            }
            // Update preview after image is loaded
            updatePreview();
        };
        reader.readAsDataURL(file);
    }
}

function handleBackgroundUpload(input) {
    const file = input.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const preview = document.getElementById('backgroundImagePreview');
            if (preview) {
                preview.src = e.target.result;
            } else {
                const placeholder = document.querySelector('.upload-placeholder');
                placeholder.innerHTML = `<img src="${e.target.result}" alt="Background" style="max-width: 100%; max-height: 200px; border-radius: 8px;">`;
            }
            // Update preview after image is loaded
            updatePreview();
        };
        reader.readAsDataURL(file);
    }
}

// Layout selection
function selectLayout(layout) {
    document.querySelectorAll('.layout-option').forEach(option => option.classList.remove('selected'));
    event.target.closest('.layout-option').classList.add('selected');
}

// Font size display
document.getElementById('fontSize').addEventListener('input', function() {
    document.getElementById('fontSizeValue').textContent = this.value + 'px';
});

// Save profile
function saveProfile(silent = false) {
    initializeProfileData();
    
    const formData = new FormData();
    
    // Add all form fields
    const formFields = [
        'fullName', 'profession', 'bio', 'location', 'industry', 
        'expertiseTags', 'linkedinUrl', 'twitterUrl', 'githubUrl', 'instagramUrl', 
        'youtubeUrl', 'websiteUrl', 'phone', 'language', 'timezone',
        'primaryColor', 'secondaryColor', 'backgroundColor', 'fontFamily', 'fontSize',
        'isAvailable', 'emailNotifications', 'showServices', 'showContent', 
        'showAbout', 'showSocial', 'serviceDescription', 'sessionDuration',
        'contentDescription', 'contentCategories'
    ];
    
    formFields.forEach(field => {
        const element = document.getElementById(field);
        if (element) {
            if (element.type === 'checkbox') {
                formData.append(field, element.checked);
            } else {
                formData.append(field, element.value);
            }
        }
    });
    
    // Add image files if uploaded
    const profileImage = document.getElementById('profileImageUpload');
    const backgroundImage = document.getElementById('backgroundImageUpload');
    
    if (profileImage && profileImage.files[0]) {
        formData.append('profile_image', profileImage.files[0]);
    }
    if (backgroundImage && backgroundImage.files[0]) {
        formData.append('background_image', backgroundImage.files[0]);
    }
    
    // Show loading state only if not silent
    let saveBtn, originalText;
    if (!silent) {
        saveBtn = document.querySelector('.btn-primary');
        if (saveBtn) {
            originalText = saveBtn.innerHTML;
            saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i><span>Saving...</span>';
            saveBtn.disabled = true;
        }
    }
    
    fetch('/api/profile/update', {
        method: 'POST',
        body: formData
    })
    .then(response => {
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        return response.json();
    })
    .then(data => {
        if (data.success) {
            if (!silent && saveBtn) {
                // Show success message
                saveBtn.innerHTML = '<i class="fas fa-check"></i><span>Saved!</span>';
                saveBtn.style.background = '#10b981';
                setTimeout(() => {
                    saveBtn.innerHTML = originalText;
                    saveBtn.style.background = '';
                    saveBtn.disabled = false;
                }, 2000);
            }
        } else {
            if (!silent) {
                alert('Failed to update profile: ' + (data.message || data.error || 'Unknown error'));
                if (saveBtn) {
                    saveBtn.innerHTML = originalText;
                    saveBtn.disabled = false;
                }
            }
        }
    })
    .catch(error => {
        console.error('Error:', error);
        if (!silent) {
            alert('Failed to update profile: ' + error.message);
            if (saveBtn) {
                saveBtn.innerHTML = originalText;
                saveBtn.disabled = false;
            }
        }
    });
}

// Preview profile
function previewProfile() {
    const url = `/profile/{{ current_user.username }}`;
    window.open(url, '_blank');
}

// Copy profile link
function copyProfileLink() {
    const profileUrl = `${window.location.origin}/profile/{{ current_user.username }}`;
    navigator.clipboard.writeText(profileUrl).then(function() {
        // Show success message
        const button = event.target.closest('.preview-action');
        const originalText = button.innerHTML;
        button.innerHTML = '<i class="fas fa-check"></i><span>Copied!</span>';
        button.style.background = '#10b981';
        button.style.borderColor = '#10b981';
        
        setTimeout(() => {
            button.innerHTML = originalText;
            button.style.background = '';
            button.style.borderColor = '';
        }, 2000);
    }).catch(function(err) {
        console.error('Could not copy text: ', err);
        alert('Could not copy link. Please copy manually: ' + profileUrl);
    });
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
    // Initialize profile data
    initializeProfileData();
    
    // Set up font size display
    const fontSizeSlider = document.getElementById('fontSize');
    const fontSizeValue = document.getElementById('fontSizeValue');
    if (fontSizeSlider && fontSizeValue) {
        fontSizeSlider.addEventListener('input', function() {
            fontSizeValue.textContent = this.value + 'px';
        });
    }
    
    // Initial preview update
    setTimeout(() => {
        updatePreview();
    }, 100);
    
    // Add event listeners to all form fields to update preview in real-time
    const formFields = [
        'fullName', 'profession', 'bio', 'location', 'industry', 
        'expertiseTags', 'linkedinUrl', 'twitterUrl', 'githubUrl', 'instagramUrl', 
        'youtubeUrl', 'websiteUrl', 'phone', 'language', 'timezone',
        'fontFamily', 'fontSize', 'primaryColor', 'secondaryColor', 'backgroundColor',
        'serviceDescription', 'sessionDuration', 'contentDescription', 'contentCategories'
    ];
    
    formFields.forEach(fieldId => {
        const element = document.getElementById(fieldId);
        if (element) {
            element.addEventListener('input', function() {
                updatePreview();
            });
            element.addEventListener('change', function() {
                updatePreview();
            });
        }
    });
    
    // Add event listeners for checkboxes
    const checkboxFields = [
        'isAvailable', 'emailNotifications', 'showServices', 'showContent', 
        'showAbout', 'showSocial'
    ];
    
    checkboxFields.forEach(fieldId => {
        const element = document.getElementById(fieldId);
        if (element) {
            element.addEventListener('change', function() {
                updatePreview();
            });
        }
    });
    
    // Add event listeners for color inputs
    const colorFields = ['primaryColor', 'secondaryColor', 'backgroundColor'];
    colorFields.forEach(fieldId => {
        const element = document.getElementById(fieldId);
        if (element) {
            element.addEventListener('input', function() {
                updatePreview();
            });
            element.addEventListener('change', function() {
                updatePreview();
            });
        }
    });
    
    // Add event listeners for color text inputs
    const colorTextFields = ['primaryColorText', 'secondaryColorText', 'backgroundColorText'];
    colorTextFields.forEach(fieldId => {
        const element = document.getElementById(fieldId);
        if (element) {
            element.addEventListener('input', function() {
                updatePreview();
            });
            element.addEventListener('change', function() {
                updatePreview();
            });
        }
    });
    
    // Add event listeners for image uploads
    const profileImageUpload = document.getElementById('profileImageUpload');
    if (profileImageUpload) {
        profileImageUpload.addEventListener('change', function() {
            handleImageUpload(this);
        });
    }
    
    const backgroundImageUpload = document.getElementById('backgroundImageUpload');
    if (backgroundImageUpload) {
        backgroundImageUpload.addEventListener('change', function() {
            handleBackgroundUpload(this);
        });
    }
});
</script>
{% endblock %}
