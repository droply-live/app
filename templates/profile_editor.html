{% extends "base_signed_in.html" %}

{% block title %}Profile - Droply{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/profile-editor.css') }}">
{% endblock %}

{% block content %}
<div class="profile-editor-container">
    <!-- Compact Header -->
    <div class="editor-header">
        <div class="header-content">
            <h1>Profile Editor</h1>
            <p>Customize your professional presence and visual design</p>
            <div class="header-note">
                <i class="fas fa-info-circle"></i>
                <span>For critical settings like username and session pricing, visit <a href="/settings" style="color: #10b981; text-decoration: underline;">Settings</a></span>
            </div>
        </div>
        <div class="header-actions">
            <button class="btn-secondary" onclick="previewProfile()">
                <i class="fas fa-external-link-alt"></i>
                <span>Preview</span>
            </button>
            <button class="btn-primary" onclick="saveProfile()">
                <i class="fas fa-check"></i>
                <span>Save Changes</span>
            </button>
        </div>
    </div>

    <div class="editor-layout">
        <!-- Compact Tab Navigation -->
        <div class="tab-navigation">
            <button class="tab-btn active" data-tab="images" onclick="switchTab('images')">
                <i class="fas fa-image"></i>
                <span>Images</span>
            </button>
            <button class="tab-btn" data-tab="appearance" onclick="switchTab('appearance')">
                <i class="fas fa-palette"></i>
                <span>Appearance</span>
            </button>
            <button class="tab-btn" data-tab="social" onclick="switchTab('social')">
                <i class="fas fa-share-alt"></i>
                <span>Social</span>
            </button>
            <button class="tab-btn" data-tab="content" onclick="switchTab('content')">
                <i class="fas fa-folder"></i>
                <span>Content</span>
            </button>
            <button class="tab-btn" data-tab="professional" onclick="switchTab('professional')">
                <i class="fas fa-briefcase"></i>
                <span>About</span>
            </button>
        </div>

        <!-- Two Panel Layout -->
        <div class="panels-container">
            <!-- Left Panel - Form Content -->
            <div class="form-panel">

            <!-- Tab Content -->
            <div class="tab-content">
                <!-- Images Tab -->
                <div id="images-tab" class="tab-panel active">
                    <div class="section">
                        <div class="section-header">
                            <div class="section-icon">
                                <i class="fas fa-image"></i>
                            </div>
                            <div class="section-title">
                                <h3>Profile Images</h3>
                                <p>Visual identity for your profile</p>
                            </div>
                        </div>
                        <div class="image-upload-grid">
                            <div class="image-upload-item">
                                <label>Profile Picture</label>
                                <div class="image-upload-area" onclick="document.getElementById('profileImageUpload').click()">
                                    <div class="upload-preview">
                                        {% if current_user.profile_picture %}
                                            <img id="profileImagePreview" src="{{ current_user.profile_picture }}" alt="Profile">
                                        {% else %}
                                            <div class="upload-placeholder">
                                                <i class="fas fa-camera"></i>
                                                <p>Upload photo</p>
                                                <small>JPG, PNG up to 5MB</small>
                                            </div>
                                        {% endif %}
                                    </div>
                                    <input type="file" id="profileImageUpload" accept="image/*" style="display: none;" onchange="handleImageUpload(this)">
                                </div>
                            </div>
                            <div class="image-upload-item">
                                <label>Background Image</label>
                                <div class="image-upload-area" onclick="document.getElementById('backgroundImageUpload').click()">
                                    <div class="upload-preview">
                                        {% if current_user.background_image_url %}
                                            <img id="backgroundImagePreview" src="{{ current_user.background_image_url }}" alt="Background">
                                        {% else %}
                                            <div class="upload-placeholder">
                                                <i class="fas fa-image"></i>
                                                <p>Upload background</p>
                                                <small>Optional header image</small>
                                            </div>
                                        {% endif %}
                                    </div>
                                    <input type="file" id="backgroundImageUpload" accept="image/*" style="display: none;" onchange="handleBackgroundUpload(this)">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Professional Tab -->
                <div id="professional-tab" class="tab-panel">
                    <div class="section">
                        <div class="section-header">
                            <div class="section-icon">
                                <i class="fas fa-briefcase"></i>
                            </div>
                            <div class="section-title">
                                <h3>About & Expertise</h3>
                                <p>Your professional information and expertise areas</p>
                            </div>
                        </div>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Full Name</label>
                                <input type="text" id="fullName" value="{{ current_user.full_name or '' }}" placeholder="Your full name" onchange="updatePreview()">
                            </div>
                            <div class="form-group">
                                <label>Profession/Title</label>
                                <input type="text" id="profession" value="{{ current_user.profession or '' }}" placeholder="e.g., Software Engineer, Consultant" onchange="updatePreview()">
                            </div>
                        </div>
                        <div class="form-group full-width">
                            <label>Bio/About</label>
                            <textarea id="bio" rows="4" placeholder="Tell us about yourself, your experience, and what you offer..." onchange="updatePreview()">{{ current_user.bio or '' }}</textarea>
                        </div>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Location</label>
                                <input type="text" id="location" value="{{ current_user.location or '' }}" placeholder="City, Country" onchange="updatePreview()">
                            </div>
                            <div class="form-group">
                                <label>Industry</label>
                                <input type="text" id="industry" value="{{ current_user.industry or '' }}" placeholder="e.g., Technology, Finance, Healthcare" onchange="updatePreview()">
                            </div>
                        </div>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Phone</label>
                                <input type="tel" id="phone" value="{{ current_user.phone or '' }}" placeholder="+1 (555) 123-4567" onchange="updatePreview()">
                            </div>
                            <div class="form-group">
                                <label>Language</label>
                                <select id="language" onchange="updatePreview()">
                                    <option value="en" {{ 'selected' if current_user.language == 'en' else '' }}>English</option>
                                    <option value="es" {{ 'selected' if current_user.language == 'es' else '' }}>Spanish</option>
                                    <option value="fr" {{ 'selected' if current_user.language == 'fr' else '' }}>French</option>
                                    <option value="de" {{ 'selected' if current_user.language == 'de' else '' }}>German</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group full-width">
                            <label>Expertise Tags</label>
                            <input type="text" id="expertiseTags" value="{{ current_user.specialty_tags or '' }}" placeholder="e.g., JavaScript, React, Node.js, Python, Machine Learning" onchange="updatePreview()">
                            <small class="form-hint">Separate tags with commas</small>
                        </div>
                        <div class="form-group">
                            <label>Timezone</label>
                            <select id="timezone" onchange="updatePreview()">
                                <option value="UTC" {{ 'selected' if current_user.timezone == 'UTC' else '' }}>UTC</option>
                                <option value="America/New_York" {{ 'selected' if current_user.timezone == 'America/New_York' else '' }}>Eastern Time</option>
                                <option value="America/Chicago" {{ 'selected' if current_user.timezone == 'America/Chicago' else '' }}>Central Time</option>
                                <option value="America/Denver" {{ 'selected' if current_user.timezone == 'America/Denver' else '' }}>Mountain Time</option>
                                <option value="America/Los_Angeles" {{ 'selected' if current_user.timezone == 'America/Los_Angeles' else '' }}>Pacific Time</option>
                                <option value="Europe/London" {{ 'selected' if current_user.timezone == 'Europe/London' else '' }}>London</option>
                                <option value="Europe/Paris" {{ 'selected' if current_user.timezone == 'Europe/Paris' else '' }}>Paris</option>
                            </select>
                        </div>
                        <div class="checkbox-grid">
                            <label class="checkbox-item">
                                <input type="checkbox" id="isAvailable" {{ 'checked' if current_user.is_available else '' }} onchange="updatePreview()">
                                <div class="checkbox-content">
                                    <span class="checkbox-title">Available for Bookings</span>
                                    <span class="checkbox-desc">Show that you're accepting new clients</span>
                                </div>
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" id="emailNotifications" {{ 'checked' if current_user.email_notifications else '' }} onchange="updatePreview()">
                                <div class="checkbox-content">
                                    <span class="checkbox-title">Email Notifications</span>
                                    <span class="checkbox-desc">Receive booking and message notifications</span>
                                </div>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Appearance Tab -->
                <div id="appearance-tab" class="tab-panel">
                    <div class="section">
                        <div class="section-header">
                            <div class="section-icon">
                                <i class="fas fa-palette"></i>
                            </div>
                            <div class="section-title">
                                <h3>Color Scheme</h3>
                                <p>Customize your profile's visual theme</p>
                            </div>
                        </div>
                        <div class="color-picker-grid">
                            <div class="color-option">
                                <label>Primary Color</label>
                                <div class="color-input-group">
                                    <input type="color" id="primaryColor" value="{{ current_user.primary_color or '#667eea' }}" onchange="updatePreview()">
                                    <input type="text" id="primaryColorText" value="{{ current_user.primary_color or '#667eea' }}" onchange="updateColorFromText('primary')" placeholder="#667eea">
                                </div>
                                <small class="form-hint">Main brand color for buttons and accents</small>
                            </div>
                            <div class="color-option">
                                <label>Secondary Color</label>
                                <div class="color-input-group">
                                    <input type="color" id="secondaryColor" value="{{ current_user.secondary_color or '#764ba2' }}" onchange="updatePreview()">
                                    <input type="text" id="secondaryColorText" value="{{ current_user.secondary_color or '#764ba2' }}" onchange="updateColorFromText('secondary')" placeholder="#764ba2">
                                </div>
                                <small class="form-hint">Secondary color for gradients and highlights</small>
                            </div>
                            <div class="color-option">
                                <label>Background Color</label>
                                <div class="color-input-group">
                                    <input type="color" id="backgroundColor" value="{{ current_user.background_color or '#f7faff' }}" onchange="updatePreview()">
                                    <input type="text" id="backgroundColorText" value="{{ current_user.background_color or '#f7faff' }}" onchange="updateColorFromText('background')" placeholder="#f7faff">
                                </div>
                                <small class="form-hint">Page background color</small>
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-header">
                            <div class="section-icon">
                                <i class="fas fa-font"></i>
                            </div>
                            <div class="section-title">
                                <h3>Typography</h3>
                                <p>Choose fonts that represent your style</p>
                            </div>
                        </div>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Font Family</label>
                                <select id="fontFamily" onchange="updatePreview()">
                                    <option value="Inter" {{ 'selected' if current_user.font_family == 'Inter' else '' }}>Inter - Modern & Clean</option>
                                    <option value="Roboto" {{ 'selected' if current_user.font_family == 'Roboto' else '' }}>Roboto - Google's Choice</option>
                                    <option value="Open Sans" {{ 'selected' if current_user.font_family == 'Open Sans' else '' }}>Open Sans - Friendly</option>
                                    <option value="Lato" {{ 'selected' if current_user.font_family == 'Lato' else '' }}>Lato - Elegant</option>
                                    <option value="Poppins" {{ 'selected' if current_user.font_family == 'Poppins' else '' }}>Poppins - Rounded</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Font Size</label>
                                <div class="range-input">
                                    <input type="range" id="fontSize" min="12" max="24" value="{{ current_user.font_size or 16 }}" onchange="updatePreview()">
                                    <div class="range-value">
                                        <span id="fontSizeValue">{{ current_user.font_size or 16 }}px</span>
                                    </div>
                                </div>
                                <small class="form-hint">Adjust text size for readability</small>
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-header">
                            <div class="section-icon">
                                <i class="fas fa-th"></i>
                            </div>
                            <div class="section-title">
                                <h3>Layout Style</h3>
                                <p>Choose your profile's visual structure</p>
                            </div>
                        </div>
                        <div class="layout-options">
                            <div class="layout-option" onclick="selectLayout('modern')">
                                <div class="layout-preview modern-layout"></div>
                                <div class="layout-info">
                                    <span class="layout-name">Modern</span>
                                    <span class="layout-desc">Clean, professional design</span>
                                </div>
                            </div>
                            <div class="layout-option" onclick="selectLayout('minimal')">
                                <div class="layout-preview minimal-layout"></div>
                                <div class="layout-info">
                                    <span class="layout-name">Minimal</span>
                                    <span class="layout-desc">Simple, focused layout</span>
                                </div>
                            </div>
                            <div class="layout-option" onclick="selectLayout('creative')">
                                <div class="layout-preview creative-layout"></div>
                                <div class="layout-info">
                                    <span class="layout-name">Creative</span>
                                    <span class="layout-desc">Bold, expressive style</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Content Tab -->
                <div id="content-tab" class="tab-panel">
                    <div class="section">
                        <div class="section-header">
                            <div class="section-icon">
                                <i class="fas fa-folder"></i>
                            </div>
                            <div class="section-title">
                                <h3>Content Management</h3>
                                <p>Control what sections appear on your profile</p>
                            </div>
                        </div>
                        <div class="checkbox-grid">
                            <label class="checkbox-item">
                                <input type="checkbox" id="showServices" checked onchange="updatePreview()">
                                <div class="checkbox-content">
                                    <span class="checkbox-title">Services</span>
                                    <span class="checkbox-desc">Show your 1-on-1 sessions</span>
                                </div>
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" id="showContent" checked onchange="updatePreview()">
                                <div class="checkbox-content">
                                    <span class="checkbox-title">Premium Content</span>
                                    <span class="checkbox-desc">Display your paid content</span>
                                </div>
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" id="showAbout" checked onchange="updatePreview()">
                                <div class="checkbox-content">
                                    <span class="checkbox-title">About</span>
                                    <span class="checkbox-desc">Show professional details</span>
                                </div>
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox" id="showSocial" checked onchange="updatePreview()">
                                <div class="checkbox-content">
                                    <span class="checkbox-title">Social Links</span>
                                    <span class="checkbox-desc">Display social media links</span>
                                </div>
                            </label>
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-header">
                            <div class="section-icon">
                                <i class="fas fa-video"></i>
                            </div>
                            <div class="section-title">
                                <h3>Services</h3>
                                <p>Configure your consultation offerings</p>
                            </div>
                        </div>
                        <div class="form-grid">
                            <div class="form-group full-width">
                                <label>Service Description</label>
                                <textarea id="serviceDescription" rows="3" placeholder="Describe your 1-on-1 sessions..." onchange="updatePreview()">{{ current_user.service_description or '' }}</textarea>
                                <small class="form-hint">Explain what clients can expect from your sessions</small>
                            </div>
                            <div class="form-group">
                                <label>Session Duration (minutes)</label>
                                <input type="number" id="sessionDuration" value="{{ current_user.session_duration or 30 }}" min="15" max="120" onchange="updatePreview()" placeholder="30">
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <div class="section-header">
                            <div class="section-icon">
                                <i class="fas fa-lock"></i>
                            </div>
                            <div class="section-title">
                                <h3>Premium Content</h3>
                                <p>Describe your paid content offerings</p>
                            </div>
                        </div>
                        <div class="form-grid">
                            <div class="form-group full-width">
                                <label>Content Description</label>
                                <textarea id="contentDescription" rows="3" placeholder="Describe your premium content offerings..." onchange="updatePreview()">{{ current_user.content_description or '' }}</textarea>
                                <small class="form-hint">What types of premium content do you offer?</small>
                            </div>
                            <div class="form-group full-width">
                                <label>Content Categories</label>
                                <input type="text" id="contentCategories" value="{{ current_user.content_categories or '' }}" placeholder="e.g., Courses, Videos, PDFs, Templates" onchange="updatePreview()">
                                <small class="form-hint">Separate categories with commas</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Social Media Tab -->
                <div id="social-tab" class="tab-panel">
                    <div class="section">
                        <div class="section-header">
                            <div class="section-icon">
                                <i class="fas fa-share-alt"></i>
                            </div>
                            <div class="section-title">
                                <h3>Social Media Links</h3>
                                <p>Connect your professional profiles</p>
                            </div>
                        </div>
                        <div class="social-links-grid">
                            <div class="social-link-item">
                                <div class="social-link-header">
                                    <i class="fab fa-linkedin"></i>
                                    <span>LinkedIn</span>
                                </div>
                                <input type="url" id="linkedinUrl" value="{{ current_user.linkedin_url or '' }}" onchange="updatePreview()" placeholder="https://linkedin.com/in/yourprofile">
                            </div>
                            <div class="social-link-item">
                                <div class="social-link-header">
                                    <i class="fab fa-twitter"></i>
                                    <span>Twitter</span>
                                </div>
                                <input type="url" id="twitterUrl" value="{{ current_user.twitter_url or '' }}" onchange="updatePreview()" placeholder="https://twitter.com/yourhandle">
                            </div>
                            <div class="social-link-item">
                                <div class="social-link-header">
                                    <i class="fab fa-github"></i>
                                    <span>GitHub</span>
                                </div>
                                <input type="url" id="githubUrl" value="{{ current_user.github_url or '' }}" onchange="updatePreview()" placeholder="https://github.com/yourusername">
                            </div>
                            <div class="social-link-item">
                                <div class="social-link-header">
                                    <i class="fab fa-instagram"></i>
                                    <span>Instagram</span>
                                </div>
                                <input type="url" id="instagramUrl" value="{{ current_user.instagram_url or '' }}" onchange="updatePreview()" placeholder="https://instagram.com/yourhandle">
                            </div>
                            <div class="social-link-item">
                                <div class="social-link-header">
                                    <i class="fab fa-youtube"></i>
                                    <span>YouTube</span>
                                </div>
                                <input type="url" id="youtubeUrl" value="{{ current_user.youtube_url or '' }}" onchange="updatePreview()" placeholder="https://youtube.com/c/yourchannel">
                            </div>
                            <div class="social-link-item">
                                <div class="social-link-header">
                                    <i class="fas fa-globe"></i>
                                    <span>Website</span>
                                </div>
                                <input type="url" id="websiteUrl" value="{{ current_user.website_url or '' }}" onchange="updatePreview()" placeholder="https://yourwebsite.com">
                            </div>
                        </div>
                    </div>
                </div>


            </div>
            </div>

            <!-- Right Panel - Live Preview -->
            <div class="preview-panel">
                <div class="preview-header">
                    <div class="preview-title">
                        <h3>Live Preview</h3>
                        <p>See how your profile looks to visitors</p>
                    </div>
                    <div class="preview-controls">
                        <div class="preview-tabs">
                            <button class="preview-tab active" onclick="switchPreview('desktop')">
                                <i class="fas fa-desktop"></i>
                                <span>Desktop</span>
                            </button>
                            <button class="preview-tab" onclick="switchPreview('mobile')">
                                <i class="fas fa-mobile-alt"></i>
                                <span>Mobile</span>
                            </button>
                        </div>
                        <button class="preview-action" onclick="copyProfileLink()">
                            <i class="fas fa-link"></i>
                            <span>Copy Link</span>
                        </button>
                    </div>
                </div>
                
                <div class="preview-container">
                    <div id="desktop-preview" class="preview-frame desktop-preview">
                        <div class="profile-preview" id="profilePreview">
                            <!-- Preview content will be dynamically generated -->
                        </div>
                    </div>
                    <div id="mobile-preview" class="preview-frame mobile-preview" style="display: none;">
                        <div class="profile-preview mobile" id="profilePreviewMobile">
                            <!-- Mobile preview content will be dynamically generated -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.profile-editor-container {
    min-height: 100vh;
    background: #1a1a1a;
}

.editor-header {
    background: #2a2a2a;
    color: white;
    padding: 1.5rem 2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-radius: 12px;
    margin-bottom: 1rem;
    border: 1px solid #3a3a3a;
}

.header-content h1 {
    margin: 0;
    font-size: 2rem;
    font-weight: 700;
}

.header-content p {
    margin: 0.5rem 0 0 0;
    opacity: 0.9;
}

.header-note {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-top: 0.75rem;
    padding: 0.5rem 0.75rem;
    background: rgba(16, 185, 129, 0.1);
    border: 1px solid rgba(16, 185, 129, 0.2);
    border-radius: 6px;
    font-size: 0.875rem;
    color: #10b981;
}

.header-note i {
    font-size: 0.875rem;
}

.editor-layout {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    padding: 2rem;
    max-width: 1600px;
    margin: 0 auto;
    min-height: calc(100vh - 120px);
    background: #1a1a1a;
}

/* Compact Tab Navigation */
.tab-navigation {
    display: flex;
    gap: 0.5rem;
    background: #2a2a2a;
    border-radius: 12px;
    padding: 0.5rem;
    box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.3);
    border: 1px solid #404040;
    overflow-x: auto;
}

.tab-btn {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1.25rem;
    border: none;
    background: none;
    cursor: pointer;
    transition: all 0.2s ease;
    border-radius: 8px;
    font-size: 0.875rem;
    font-weight: 500;
    color: #cccccc;
    white-space: nowrap;
    min-width: fit-content;
}

.tab-btn:hover {
    background: #404040;
    color: #ffffff;
}

.tab-btn.active {
    background: #10b981;
    color: white;
    box-shadow: 0 2px 4px rgba(16, 185, 129, 0.2);
}

.tab-btn i {
    font-size: 1rem;
}

/* Two Panel Layout */
.panels-container {
    display: grid;
    grid-template-columns: 420px 1fr;
    gap: 2rem;
    height: calc(100vh - 200px);
    min-height: 600px;
}

/* Form Panel */
.form-panel {
    background: white;
    border-radius: 12px;
    box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
    border: 1px solid #e2e8f0;
    overflow: hidden;
    display: flex;
    flex-direction: column;
}

/* Preview Panel */
.preview-panel {
    background: white;
    border-radius: 12px;
    box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
    border: 1px solid #e2e8f0;
    overflow: hidden;
    display: flex;
    flex-direction: column;
}

/* Tab Content */
.tab-content {
    padding: 2rem;
    flex: 1;
    overflow-y: auto;
}

/* Preview Header */
.preview-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1.5rem;
    border-bottom: 1px solid #e2e8f0;
    background: #f8fafc;
}

.preview-title h3 {
    margin: 0;
    font-size: 1.125rem;
    font-weight: 600;
    color: #1e293b;
}

.preview-title p {
    margin: 0.25rem 0 0 0;
    font-size: 0.875rem;
    color: #64748b;
}

.preview-controls {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.preview-tabs {
    display: flex;
    background: #f1f5f9;
    border-radius: 8px;
    padding: 0.25rem;
}

.preview-tab {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    border: none;
    background: none;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.2s ease;
    font-size: 0.875rem;
    color: #64748b;
}

.preview-tab.active {
    background: white;
    color: #1e293b;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
}

.preview-action {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    background: #f1f5f9;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
    font-size: 0.875rem;
    color: #64748b;
}

.preview-action:hover {
    background: #e2e8f0;
    color: #374151;
}

.preview-container {
    flex: 1;
    padding: 1.5rem;
    overflow-y: auto;
}

.preview-frame {
    width: 100%;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    overflow: hidden;
    background: white;
}

.desktop-preview {
    min-height: 500px;
}

.mobile-preview {
    max-width: 375px;
    margin: 0 auto;
    min-height: 600px;
}

.profile-preview {
    width: 100%;
    height: 100%;
    background: white;
}

/* Mobile preview styles */
.profile-preview.mobile {
    font-size: 14px;
}

.profile-preview.mobile .profile-header {
    padding: 1rem;
}

.profile-preview.mobile .profile-name {
    font-size: 1.5rem;
}

.profile-preview.mobile .profile-title {
    font-size: 1rem;
}

.tab-panel {
    display: none;
}

.tab-panel.active {
    display: block;
}

.section {
    margin-bottom: 2rem;
}

.section h3 {
    font-size: 1.1rem;
    font-weight: 600;
    margin-bottom: 1rem;
    color: #374151;
}

.form-group {
    margin-bottom: 1.5rem;
}

.form-group label {
    display: block;
    font-weight: 500;
    margin-bottom: 0.5rem;
    color: #374151;
}

.form-group input,
.form-group select,
.form-group textarea {
    width: 100%;
    padding: 0.75rem;
    border: 1px solid #d1d5db;
    border-radius: 6px;
    font-size: 0.9rem;
    transition: border-color 0.2s ease, box-shadow 0.2s ease;
}

.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
    outline: none;
    border-color: #10b981;
    box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
}

.color-picker-group {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.color-option {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.color-input-group {
    display: flex;
    gap: 0.5rem;
}

.color-input-group input[type="color"] {
    width: 50px;
    height: 40px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
}

.color-input-group input[type="text"] {
    flex: 1;
}

.image-upload-area {
    border: 2px dashed #d1d5db;
    border-radius: 8px;
    padding: 2rem;
    text-align: center;
    cursor: pointer;
    transition: all 0.2s;
}

.image-upload-area:hover {
    border-color: #10b981;
    background: #ECFDF5;
}

.upload-preview img {
    max-width: 100%;
    max-height: 200px;
    border-radius: 8px;
}

.upload-placeholder {
    color: #6b7280;
}

.upload-placeholder i {
    font-size: 2rem;
    margin-bottom: 0.5rem;
}

.social-links-grid {
    display: grid;
    gap: 1rem;
}

.social-link-item {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.social-link-item label {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.social-link-item label i {
    width: 20px;
    color: #10b981;
}

.layout-options {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1rem;
}

.layout-option {
    text-align: center;
    cursor: pointer;
    padding: 1rem;
    border: 2px solid #e5e7eb;
    border-radius: 8px;
    transition: all 0.2s;
}

.layout-option:hover {
    border-color: #10b981;
}

.layout-option.selected {
    border-color: #10b981;
    background: #ECFDF5;
}

.layout-preview {
    height: 60px;
    border-radius: 4px;
    margin-bottom: 0.5rem;
}

.modern-layout {
    background: linear-gradient(135deg, #10b981, #047857);
}

.minimal-layout {
    background: linear-gradient(135deg, #f3f4f6, #e5e7eb);
}

.creative-layout {
    background: linear-gradient(135deg, #fbbf24, #f59e0b);
}

.checkbox-group {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.checkbox-group label {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-weight: normal;
}

.preview-panel {
    background: white;
    border-radius: 12px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    overflow: hidden;
}

.preview-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1.5rem;
    border-bottom: 1px solid #e5e7eb;
}

.preview-controls {
    display: flex;
    gap: 0.5rem;
}

.preview-btn {
    padding: 0.5rem;
    border: 1px solid #d1d5db;
    background: white;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.2s;
}

.preview-btn.active {
    background: #10b981;
    color: white;
    border-color: #10b981;
}

/* Button Styles */
.btn-primary, .btn-secondary {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1.5rem;
    border: none;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    text-decoration: none;
}

.btn-primary {
    background: #10b981;
    color: white;
}

.btn-primary:hover {
    background: #047857;
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
}

.btn-secondary {
    background: #f1f5f9;
    color: #64748b;
    border: 1px solid #e2e8f0;
}

.btn-secondary:hover {
    background: #e2e8f0;
    color: #374151;
    transform: translateY(-1px);
}

.preview-container {
    padding: 2rem;
    height: 600px;
    overflow-y: auto;
}

.preview-frame {
    width: 100%;
    height: 100%;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
    overflow: hidden;
}

.desktop-preview {
    min-height: 500px;
}

.mobile-preview {
    max-width: 375px;
    margin: 0 auto;
    min-height: 600px;
}

.profile-preview {
    width: 100%;
    height: 100%;
    background: white;
}

/* Mobile preview styles */
.profile-preview.mobile {
    font-size: 14px;
}

.profile-preview.mobile .profile-header {
    padding: 1rem;
}

.profile-preview.mobile .profile-name {
    font-size: 1.5rem;
}

.profile-preview.mobile .profile-title {
    font-size: 1rem;
}

@media (max-width: 1200px) {
    .panels-container {
        grid-template-columns: 1fr;
        gap: 1rem;
        height: auto;
    }
    
    .form-panel {
        order: 2;
    }
    
    .preview-panel {
        order: 1;
    }
    
    .editor-layout {
        padding: 1rem;
    }
}

@media (max-width: 768px) {
    .editor-layout {
        padding: 1rem;
    }
    
    .tab-navigation {
        flex-wrap: wrap;
        gap: 0.25rem;
    }
    
    .tab-btn {
        padding: 0.5rem 1rem;
        font-size: 0.8rem;
    }
    
    .form-grid {
        grid-template-columns: 1fr;
    }
    
    .image-upload-grid {
        grid-template-columns: 1fr;
    }
    
    .layout-options {
        grid-template-columns: 1fr;
    }
    
    .preview-header {
        flex-direction: column;
        gap: 1rem;
    }
    
    .preview-controls {
        width: 100%;
        justify-content: center;
    }
}
</style>

<script>
let currentTab = 'images';
let currentPreview = 'desktop';
let profileData = {};

// Initialize profile data
function initializeProfileData() {
    profileData = {
        primaryColor: document.getElementById('primaryColor')?.value || '#667eea',
        secondaryColor: document.getElementById('secondaryColor')?.value || '#764ba2',
        backgroundColor: document.getElementById('backgroundColor')?.value || '#f7faff',
        fontFamily: document.getElementById('fontFamily')?.value || 'Inter',
        fontSize: document.getElementById('fontSize')?.value || 16,
        fullName: document.getElementById('fullName')?.value || '{{ current_user.full_name or "Your Name" }}',
        profession: document.getElementById('profession')?.value || '{{ current_user.profession or "Professional" }}',
        bio: document.getElementById('bio')?.value || '{{ current_user.bio or "Tell us about yourself..." }}',
        location: document.getElementById('location')?.value || '{{ current_user.location or "Your Location" }}',
        industry: document.getElementById('industry')?.value || '{{ current_user.industry or "" }}',
        hourlyRate: '{{ current_user.hourly_rate or 0 }}', // From server, not form
        expertiseTags: document.getElementById('expertiseTags')?.value || '{{ current_user.specialty_tags or "" }}',
        linkedinUrl: document.getElementById('linkedinUrl')?.value || '{{ current_user.linkedin_url or "" }}',
        twitterUrl: document.getElementById('twitterUrl')?.value || '{{ current_user.twitter_url or "" }}',
        githubUrl: document.getElementById('githubUrl')?.value || '{{ current_user.github_url or "" }}',
        instagramUrl: document.getElementById('instagramUrl')?.value || '{{ current_user.instagram_url or "" }}',
        youtubeUrl: document.getElementById('youtubeUrl')?.value || '{{ current_user.youtube_url or "" }}',
        websiteUrl: document.getElementById('websiteUrl')?.value || '{{ current_user.website_url or "" }}',
        phone: document.getElementById('phone')?.value || '{{ current_user.phone or "" }}',
        language: document.getElementById('language')?.value || '{{ current_user.language or "en" }}',
        timezone: document.getElementById('timezone')?.value || '{{ current_user.timezone or "UTC" }}',
        isAvailable: document.getElementById('isAvailable')?.checked || true,
        emailNotifications: document.getElementById('emailNotifications')?.checked || true,
        showServices: document.getElementById('showServices')?.checked || true,
        showContent: document.getElementById('showContent')?.checked || true,
        showAbout: document.getElementById('showAbout')?.checked || true,
        showSocial: document.getElementById('showSocial')?.checked || true
    };
}

// Tab switching
function switchTab(tabName) {
    // Update tab buttons
    document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
    const clickedBtn = event.target.closest('.tab-btn');
    if (clickedBtn) {
        clickedBtn.classList.add('active');
    }
    
    // Update tab panels
    document.querySelectorAll('.tab-panel').forEach(panel => panel.classList.remove('active'));
    const targetPanel = document.getElementById(tabName + '-tab');
    if (targetPanel) {
        targetPanel.classList.add('active');
    }
    
    currentTab = tabName;
    
    // Update preview after tab switch
    setTimeout(() => {
        updatePreview();
    }, 50);
}

// Preview switching
function switchPreview(previewType) {
    document.querySelectorAll('.preview-tab').forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');
    
    document.getElementById('desktop-preview').style.display = previewType === 'desktop' ? 'block' : 'none';
    document.getElementById('mobile-preview').style.display = previewType === 'mobile' ? 'block' : 'none';
    
    currentPreview = previewType;
    updatePreview();
}

// Update preview
function updatePreview() {
    // Re-initialize profile data to get current form values
    initializeProfileData();
    
    const previewElement = currentPreview === 'mobile' ? 
        document.getElementById('profilePreviewMobile') : 
        document.getElementById('profilePreview');
    
    if (!previewElement) {
        console.error('Preview element not found:', currentPreview === 'mobile' ? 'profilePreviewMobile' : 'profilePreview');
        return;
    }
    
    // Generate and set the preview HTML
    const previewHTML = generatePreviewHTML();
    previewElement.innerHTML = previewHTML;
    previewElement.style.fontFamily = profileData.fontFamily;
    previewElement.style.fontSize = profileData.fontSize + 'px';
    
    // Re-render feather icons if they exist
    if (window.feather) {
        feather.replace();
    }
}

// Generate preview HTML
function generatePreviewHTML() {
    const socialLinks = [];
    if (profileData.linkedinUrl) socialLinks.push({name: 'LinkedIn', url: profileData.linkedinUrl, icon: 'fab fa-linkedin'});
    if (profileData.twitterUrl) socialLinks.push({name: 'Twitter', url: profileData.twitterUrl, icon: 'fab fa-twitter'});
    if (profileData.githubUrl) socialLinks.push({name: 'GitHub', url: profileData.githubUrl, icon: 'fab fa-github'});
    if (profileData.instagramUrl) socialLinks.push({name: 'Instagram', url: profileData.instagramUrl, icon: 'fab fa-instagram'});
    if (profileData.youtubeUrl) socialLinks.push({name: 'YouTube', url: profileData.youtubeUrl, icon: 'fab fa-youtube'});
    if (profileData.websiteUrl) socialLinks.push({name: 'Website', url: profileData.websiteUrl, icon: 'fas fa-globe'});
    
    return `
        <div class="modern-profile-page" style="background: #ffffff; color: #1a1a1a; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;">
            <!-- Navigation -->
            <div class="header-nav" style="display: flex; justify-content: space-between; align-items: center; padding: 1rem 0; margin-bottom: 2rem;">
                <a href="#" class="nav-back" style="display: flex; align-items: center; gap: 0.5rem; color: #6b7280; text-decoration: none; font-size: 0.9rem;">
                    <i class="fas fa-arrow-left"></i>
                    <span>Back to Discover</span>
                </a>
                <div class="nav-actions" style="display: flex; gap: 0.5rem;">
                    <button class="action-btn" style="padding: 0.5rem; border: 1px solid #e5e7eb; background: #ffffff; border-radius: 6px; color: #6b7280; cursor: pointer;">
                        <i class="fas fa-share-alt"></i>
                    </button>
                    <button class="action-btn" style="padding: 0.5rem; border: 1px solid #e5e7eb; background: #ffffff; border-radius: 6px; color: #6b7280; cursor: pointer;">
                        <i class="far fa-heart"></i>
                    </button>
                </div>
            </div>

            <!-- Main Content -->
            <div class="profile-content">
                <div class="content-container" style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; max-width: 1200px; margin: 0 auto;">
                    <!-- Left Column: About & Social -->
                    <div class="content-left">
                        <!-- Profile Image Section -->
                        <div class="content-section" style="background: #ffffff; border: 1px solid #f3f4f6; border-radius: 12px; padding: 2rem; margin-bottom: 2rem; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);">
                            <div class="profile-image-container" style="text-align: center; margin-bottom: 1.5rem;">
                                <img src="${document.getElementById('profileImagePreview')?.src || '/static/img/default-avatar.svg'}" 
                                     alt="Profile" 
                                     style="width: 120px; height: 120px; border-radius: 50%; object-fit: cover; border: 3px solid #f3f4f6;">
                            </div>
                            
                            <div class="profile-name-section" style="text-align: center;">
                                <h1 style="font-size: 1.75rem; font-weight: 700; margin: 0 0 0.5rem 0; color: #1a1a1a;">${profileData.fullName || 'Your Name'}</h1>
                                ${profileData.profession ? `<p style="font-size: 1.1rem; color: #6b7280; margin: 0 0 0.5rem 0;">${profileData.profession}</p>` : ''}
                                ${profileData.location ? `<p style="color: #9ca3af; margin: 0 0 1rem 0; font-size: 0.9rem;">
                                    <i class="fas fa-map-marker-alt" style="margin-right: 0.25rem;"></i>
                                    ${profileData.location}
                                </p>` : ''}
                                
                                <!-- Social Media Icons -->
                                <div class="profile-social-icons" style="display: flex; justify-content: center; gap: 0.75rem; flex-wrap: wrap;">
                                    ${socialLinks.map(link => `
                                        <a href="${link.url}" target="_blank" style="display: flex; align-items: center; justify-content: center; width: 40px; height: 40px; background: #f1f5f9; border: 1px solid #e5e7eb; border-radius: 6px; color: #6b7280; text-decoration: none; transition: all 0.2s;">
                                            <i class="${link.icon}"></i>
                                        </a>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                        
                        <!-- About Section -->
                        ${profileData.bio ? `
                        <div class="content-section" style="background: #ffffff; border: 1px solid #f3f4f6; border-radius: 12px; padding: 2rem; margin-bottom: 2rem; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);">
                            <h2 style="font-size: 1.25rem; font-weight: 600; margin: 0 0 1rem 0; color: #1a1a1a;">About Me</h2>
                            <div class="bio-content">
                                <p style="color: #6b7280; line-height: 1.6; margin: 0;">${profileData.bio}</p>
                            </div>
                        </div>
                        ` : ''}
                        
                        <!-- Expertise Section -->
                        ${profileData.expertiseTags ? `
                        <div class="content-section" style="background: #ffffff; border: 1px solid #f3f4f6; border-radius: 12px; padding: 2rem; margin-bottom: 2rem; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);">
                            <h2 style="font-size: 1.25rem; font-weight: 600; margin: 0 0 1rem 0; color: #1a1a1a;">Expertise</h2>
                            <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                                ${profileData.expertiseTags.split(',').map(tag => `
                                    <span style="background: #f1f5f9; color: #6b7280; padding: 0.25rem 0.75rem; border-radius: 8px; font-size: 0.875rem; border: 1px solid #e5e7eb;">${tag.trim()}</span>
                                `).join('')}
                            </div>
                        </div>
                        ` : ''}
                    </div>
                    
                    <!-- Right Column: Services & Pricing -->
                    <div class="content-right">
                        <!-- Services Section -->
                        <div class="content-section" style="background: #ffffff; border: 1px solid #f3f4f6; border-radius: 12px; padding: 2rem; margin-bottom: 2rem; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);">
                            <h2 style="font-size: 1.25rem; font-weight: 600; margin: 0 0 1rem 0; color: #1a1a1a;">Services</h2>
                            <div class="service-card" style="background: #f1f5f9; border: 1px solid #e5e7eb; border-radius: 8px; padding: 1.5rem;">
                                <h3 style="font-size: 1.1rem; font-weight: 600; margin: 0 0 0.5rem 0; color: #1a1a1a;">1-on-1 Consultation</h3>
                                <p style="color: #6b7280; margin: 0 0 1rem 0; font-size: 0.9rem;">Personalized session to help you achieve your goals</p>
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <span style="font-size: 1.25rem; font-weight: 700; color: #1a1a1a;">$${profileData.hourlyRate || 0}/hour</span>
                                    <button style="background: #10b981; color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 6px; font-weight: 600; cursor: pointer; transition: all 0.2s;">Book Session</button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Availability Status -->
                        <div class="content-section" style="background: #ffffff; border: 1px solid #f3f4f6; border-radius: 12px; padding: 2rem; margin-bottom: 2rem; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);">
                            <h2 style="font-size: 1.25rem; font-weight: 600; margin: 0 0 1rem 0; color: #1a1a1a;">Availability</h2>
                            <div style="display: flex; align-items: center; gap: 0.75rem;">
                                <div style="width: 12px; height: 12px; border-radius: 50%; background: ${profileData.isAvailable ? '#10b981' : '#ef4444'};"></div>
                                <span style="color: #6b7280; font-weight: 500;">${profileData.isAvailable ? 'Available for bookings' : 'Currently unavailable'}</span>
                            </div>
                        </div>
                        
                        <!-- Industry & Location -->
                        <div class="content-section" style="background: #ffffff; border: 1px solid #f3f4f6; border-radius: 12px; padding: 2rem; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);">
                            <h2 style="font-size: 1.25rem; font-weight: 600; margin: 0 0 1rem 0; color: #1a1a1a;">Details</h2>
                            <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                                ${profileData.industry ? `
                                <div style="display: flex; align-items: center; gap: 0.75rem;">
                                    <i class="fas fa-briefcase" style="color: #9ca3af; width: 16px;"></i>
                                    <span style="color: #6b7280;">${profileData.industry}</span>
                                </div>
                                ` : ''}
                                ${profileData.location ? `
                                <div style="display: flex; align-items: center; gap: 0.75rem;">
                                    <i class="fas fa-map-marker-alt" style="color: #9ca3af; width: 16px;"></i>
                                    <span style="color: #6b7280;">${profileData.location}</span>
                                </div>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `;
}

// Color input synchronization
function updateColorFromText(colorType) {
    const textInput = document.getElementById(colorType + 'ColorText');
    const colorInput = document.getElementById(colorType + 'Color');
    colorInput.value = textInput.value;
    // Update preview after color change
    updatePreview();
}

// Image upload handling
function handleImageUpload(input) {
    const file = input.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const preview = document.getElementById('profileImagePreview');
            if (preview) {
                preview.src = e.target.result;
            } else {
                const placeholder = document.querySelector('.upload-placeholder');
                placeholder.innerHTML = `<img src="${e.target.result}" alt="Profile" style="max-width: 100%; max-height: 200px; border-radius: 8px;">`;
            }
            // Update preview after image is loaded
            updatePreview();
        };
        reader.readAsDataURL(file);
    }
}

function handleBackgroundUpload(input) {
    const file = input.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const preview = document.getElementById('backgroundImagePreview');
            if (preview) {
                preview.src = e.target.result;
            } else {
                const placeholder = document.querySelector('.upload-placeholder');
                placeholder.innerHTML = `<img src="${e.target.result}" alt="Background" style="max-width: 100%; max-height: 200px; border-radius: 8px;">`;
            }
            // Update preview after image is loaded
            updatePreview();
        };
        reader.readAsDataURL(file);
    }
}

// Layout selection
function selectLayout(layout) {
    document.querySelectorAll('.layout-option').forEach(option => option.classList.remove('selected'));
    event.target.closest('.layout-option').classList.add('selected');
}

// Font size display
document.getElementById('fontSize').addEventListener('input', function() {
    document.getElementById('fontSizeValue').textContent = this.value + 'px';
});

// Save profile
function saveProfile() {
    initializeProfileData();
    
    const formData = new FormData();
    
    // Add all form fields
    const formFields = [
        'fullName', 'profession', 'bio', 'location', 'industry', 
        'expertiseTags', 'linkedinUrl', 'twitterUrl', 'githubUrl', 'instagramUrl', 
        'youtubeUrl', 'websiteUrl', 'phone', 'language', 'timezone',
        'primaryColor', 'secondaryColor', 'backgroundColor', 'fontFamily', 'fontSize',
        'isAvailable', 'emailNotifications', 'showServices', 'showContent', 
        'showAbout', 'showSocial', 'serviceDescription', 'sessionDuration',
        'contentDescription', 'contentCategories'
    ];
    
    formFields.forEach(field => {
        const element = document.getElementById(field);
        if (element) {
            if (element.type === 'checkbox') {
                formData.append(field, element.checked);
            } else {
                formData.append(field, element.value);
            }
        }
    });
    
    // Add image files if uploaded
    const profileImage = document.getElementById('profileImageUpload');
    const backgroundImage = document.getElementById('backgroundImageUpload');
    
    if (profileImage && profileImage.files[0]) {
        formData.append('profile_image', profileImage.files[0]);
    }
    if (backgroundImage && backgroundImage.files[0]) {
        formData.append('background_image', backgroundImage.files[0]);
    }
    
    // Show loading state
    const saveBtn = document.querySelector('.btn-primary');
    const originalText = saveBtn.innerHTML;
    saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i><span>Saving...</span>';
    saveBtn.disabled = true;
    
    fetch('/api/profile/update', {
        method: 'POST',
        body: formData
    })
    .then(response => {
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        return response.json();
    })
    .then(data => {
        if (data.success) {
            // Show success message
            saveBtn.innerHTML = '<i class="fas fa-check"></i><span>Saved!</span>';
            saveBtn.style.background = '#10b981';
            setTimeout(() => {
                saveBtn.innerHTML = originalText;
                saveBtn.style.background = '';
                saveBtn.disabled = false;
            }, 2000);
        } else {
            alert('Failed to update profile: ' + (data.message || data.error || 'Unknown error'));
            saveBtn.innerHTML = originalText;
            saveBtn.disabled = false;
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Failed to update profile: ' + error.message);
        saveBtn.innerHTML = originalText;
        saveBtn.disabled = false;
    });
}

// Preview profile
function previewProfile() {
    const url = `/profile/{{ current_user.username }}`;
    window.open(url, '_blank');
}

// Copy profile link
function copyProfileLink() {
    const profileUrl = `${window.location.origin}/profile/{{ current_user.username }}`;
    navigator.clipboard.writeText(profileUrl).then(function() {
        // Show success message
        const button = event.target.closest('.preview-action');
        const originalText = button.innerHTML;
        button.innerHTML = '<i class="fas fa-check"></i><span>Copied!</span>';
        button.style.background = '#10b981';
        button.style.borderColor = '#10b981';
        
        setTimeout(() => {
            button.innerHTML = originalText;
            button.style.background = '';
            button.style.borderColor = '';
        }, 2000);
    }).catch(function(err) {
        console.error('Could not copy text: ', err);
        alert('Could not copy link. Please copy manually: ' + profileUrl);
    });
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
    // Initialize profile data
    initializeProfileData();
    
    // Set up font size display
    const fontSizeSlider = document.getElementById('fontSize');
    const fontSizeValue = document.getElementById('fontSizeValue');
    if (fontSizeSlider && fontSizeValue) {
        fontSizeSlider.addEventListener('input', function() {
            fontSizeValue.textContent = this.value + 'px';
        });
    }
    
    // Initial preview update
    setTimeout(() => {
        updatePreview();
    }, 100);
    
    // Add event listeners to all form fields to update preview in real-time
    const formFields = [
        'fullName', 'profession', 'bio', 'location', 'industry', 
        'expertiseTags', 'linkedinUrl', 'twitterUrl', 'githubUrl', 'instagramUrl', 
        'youtubeUrl', 'websiteUrl', 'phone', 'language', 'timezone',
        'fontFamily', 'fontSize', 'primaryColor', 'secondaryColor', 'backgroundColor',
        'serviceDescription', 'sessionDuration', 'contentDescription', 'contentCategories'
    ];
    
    formFields.forEach(fieldId => {
        const element = document.getElementById(fieldId);
        if (element) {
            element.addEventListener('input', function() {
                updatePreview();
            });
            element.addEventListener('change', function() {
                updatePreview();
            });
        }
    });
    
    // Add event listeners for checkboxes
    const checkboxFields = [
        'isAvailable', 'emailNotifications', 'showServices', 'showContent', 
        'showAbout', 'showSocial'
    ];
    
    checkboxFields.forEach(fieldId => {
        const element = document.getElementById(fieldId);
        if (element) {
            element.addEventListener('change', function() {
                updatePreview();
            });
        }
    });
    
    // Add event listeners for color inputs
    const colorFields = ['primaryColor', 'secondaryColor', 'backgroundColor'];
    colorFields.forEach(fieldId => {
        const element = document.getElementById(fieldId);
        if (element) {
            element.addEventListener('input', function() {
                updatePreview();
            });
            element.addEventListener('change', function() {
                updatePreview();
            });
        }
    });
    
    // Add event listeners for color text inputs
    const colorTextFields = ['primaryColorText', 'secondaryColorText', 'backgroundColorText'];
    colorTextFields.forEach(fieldId => {
        const element = document.getElementById(fieldId);
        if (element) {
            element.addEventListener('input', function() {
                updatePreview();
            });
            element.addEventListener('change', function() {
                updatePreview();
            });
        }
    });
    
    // Add event listeners for image uploads
    const profileImageUpload = document.getElementById('profileImageUpload');
    if (profileImageUpload) {
        profileImageUpload.addEventListener('change', function() {
            handleImageUpload(this);
        });
    }
    
    const backgroundImageUpload = document.getElementById('backgroundImageUpload');
    if (backgroundImageUpload) {
        backgroundImageUpload.addEventListener('change', function() {
            handleBackgroundUpload(this);
        });
    }
});
</script>
{% endblock %}
