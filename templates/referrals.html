{% extends "base_signed_in.html" %}

{% block title %}Referrals - Droply{% endblock %}

{% block content %}
<div class="container-fluid h-100 d-flex align-items-start justify-content-center" style="min-height: 100vh; overflow: hidden; padding-top: 2vh;">
    <div class="container">
        <!-- Referrals Content -->
        <div class="row" id="referrals-content" style="opacity: 0; transition: opacity 0.3s ease;">
            <!-- Main Referrals Card -->
            <div class="col-12">
                <div class="card referrals-card">
                    <div class="card-header">
                        <h6 class="mb-0 text-center">
                            <i class="fas fa-share-alt me-2"></i>
                            Referrals Management
                        </h6>
                    </div>
                    <div class="card-body">
                        <!-- Three Column Layout -->
                        <div class="referrals-columns-container">
                            <!-- Overview Column -->
                            <div class="referrals-column">
                                <div class="column-header">
                                    <h6 class="column-title text-center">
                                        <i class="fas fa-chart-pie me-2"></i>
                                        Overview
                                    </h6>
                                </div>
                                <div class="column-content">
                                    <!-- Referral Summary -->
                                    <div class="referrals-section-compact">
                                        <h6 class="section-title-compact">
                                            <i class="fas fa-gift me-2"></i>
                                            Summary
                                        </h6>
                                        <div class="referrals-summary-compact">
                                            <div class="summary-item">
                                                <div class="summary-icon success">
                                                    <i class="fas fa-users"></i>
                                                </div>
                                                <div class="summary-details">
                                                    <h6 class="summary-amount">{{ current_user.referral_count or 0 }}</h6>
                                                    <p class="summary-label">Total Referrals</p>
                                                </div>
                                            </div>
                                            
                                            <div class="summary-item">
                                                <div class="summary-icon primary">
                                                    <i class="fas fa-dollar-sign"></i>
                                                </div>
                                                <div class="summary-details">
                                                    <h6 class="summary-amount">${{ "%.2f"|format(current_user.total_referral_earnings or 0) }}</h6>
                                                    <p class="summary-label">Total Earnings</p>
                                                </div>
                                            </div>
                                            
                                            <div class="summary-item">
                                                <div class="summary-icon warning">
                                                    <i class="fas fa-percentage"></i>
                                                </div>
                                                <div class="summary-details">
                                                    <h6 class="summary-amount">$10</h6>
                                                    <p class="summary-label">Per Referral</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Recent Activity -->
                                    <div class="referrals-section-compact">
                                        <h6 class="section-title-compact">
                                            <i class="fas fa-history me-2"></i>
                                            Recent Activity
                                        </h6>
                                        <div id="referral-activity-list" class="activity-list-compact">
                                            <div class="text-center text-muted py-3">
                                                <i class="fas fa-spinner fa-spin"></i>
                                                <p class="mb-0">Loading activity...</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Share & Link Column -->
                            <div class="referrals-column">
                                <div class="column-header">
                                    <h6 class="column-title text-center">
                                        <i class="fas fa-link me-2"></i>
                                        Share & Link
                                    </h6>
                                </div>
                                <div class="column-content">
                                    <!-- Referral Link -->
                                    <div class="referrals-section-compact">
                                        <h6 class="section-title-compact">
                                            <i class="fas fa-copy me-2"></i>
                                            Your Referral Link
                                        </h6>
                                        <div class="referral-link-container">
                                            <div class="input-group input-group-sm">
                                                <input type="text" class="form-control form-control-sm" id="referral-link" readonly 
                                                       value="{{ current_user.get_referral_link() if current_user.referral_code else 'Generating...' }}">
                                                <button class="btn btn-outline-primary btn-sm" type="button" id="copy-referral-link">
                                                    <i class="fas fa-copy"></i>
                                                </button>
                                            </div>
                                            <small class="text-muted mt-2 d-block">
                                                <i class="fas fa-info-circle me-1"></i>
                                                Share this link to earn $10 for each successful referral
                                            </small>
                                        </div>
                                    </div>
                                    
                                    <!-- Quick Actions -->
                                    <div class="referrals-section-compact">
                                        <h6 class="section-title-compact">
                                            <i class="fas fa-rocket me-2"></i>
                                            Quick Actions
                                        </h6>
                                        <div class="quick-actions-compact">
                                            <button class="btn btn-primary btn-sm w-100 mb-2" id="share-email">
                                                <i class="fas fa-envelope me-2"></i>
                                                Share via Email
                                            </button>
                                            <button class="btn btn-outline-primary btn-sm w-100 mb-2" id="share-social">
                                                <i class="fas fa-share-alt me-2"></i>
                                                Share on Social
                                            </button>
                                            <button class="btn btn-outline-secondary btn-sm w-100" id="generate-new-code">
                                                <i class="fas fa-refresh me-2"></i>
                                                Generate New Code
                                            </button>
                                        </div>
                                    </div>
                                    
                                    <!-- Referral Code -->
                                    <div class="referrals-section-compact">
                                        <h6 class="section-title-compact">
                                            <i class="fas fa-tag me-2"></i>
                                            Your Code
                                        </h6>
                                        <div class="referral-code-display">
                                            <div class="code-container">
                                                <span class="referral-code-text">{{ current_user.referral_code or 'Generating...' }}</span>
                                                <button class="btn btn-outline-primary btn-xs ms-2" id="copy-referral-code">
                                                    <i class="fas fa-copy"></i>
                                                </button>
                                            </div>
                                            <small class="text-muted mt-2 d-block">
                                                <i class="fas fa-info-circle me-1"></i>
                                                Friends can use this code during signup
                                            </small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- History & Analytics Column -->
                            <div class="referrals-column">
                                <div class="column-header">
                                    <h6 class="column-title text-center">
                                        <i class="fas fa-chart-line me-2"></i>
                                        History & Analytics
                                    </h6>
                                </div>
                                <div class="column-content">
                                    <!-- Referral History -->
                                    <div class="referrals-section-compact">
                                        <h6 class="section-title-compact">
                                            <i class="fas fa-list me-2"></i>
                                            Referral History
                                        </h6>
                                        <div id="referral-history-list" class="history-list-compact">
                                            <div class="text-center text-muted py-3">
                                                <i class="fas fa-spinner fa-spin"></i>
                                                <p class="mb-0">Loading history...</p>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Performance Stats -->
                                    <div class="referrals-section-compact">
                                        <h6 class="section-title-compact">
                                            <i class="fas fa-trophy me-2"></i>
                                            Performance
                                        </h6>
                                        <div class="performance-stats-compact">
                                            <div class="stat-item">
                                                <div class="stat-label">Conversion Rate</div>
                                                <div class="stat-value" id="conversion-rate">0%</div>
                                            </div>
                                            <div class="stat-item">
                                                <div class="stat-label">This Month</div>
                                                <div class="stat-value" id="monthly-referrals">0</div>
                                            </div>
                                            <div class="stat-item">
                                                <div class="stat-label">Best Month</div>
                                                <div class="stat-value" id="best-month">0</div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Tips & Guidelines -->
                                    <div class="referrals-section-compact">
                                        <h6 class="section-title-compact">
                                            <i class="fas fa-lightbulb me-2"></i>
                                            Tips
                                        </h6>
                                        <div class="tips-compact">
                                            <div class="tip-item">
                                                <i class="fas fa-check-circle text-success me-2"></i>
                                                <small>Share on social media for maximum reach</small>
                                            </div>
                                            <div class="tip-item">
                                                <i class="fas fa-check-circle text-success me-2"></i>
                                                <small>Personal messages work better than generic posts</small>
                                            </div>
                                            <div class="tip-item">
                                                <i class="fas fa-check-circle text-success me-2"></i>
                                                <small>Explain the value of Droply to your network</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
/* Page Layout - Prevent Scrolling and Center Content */
body {
    overflow: hidden;
    height: 100vh;
}

.container-fluid {
    padding: 0;
    margin: 0;
}

/* Referrals Card */
.referrals-card {
    border: 1px solid #e9ecef;
    border-radius: 12px;
    box-shadow: none;
    max-height: 80vh;
    overflow: hidden;
}

.referrals-card:hover {
    box-shadow: 0 4px 12px rgba(0,0,0,0.15) !important;
    transform: none !important;
}

.referrals-card .card-header {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border-bottom: 1px solid #dee2e6;
    border-radius: 12px 12px 0 0;
    padding: 20px 24px;
}

.referrals-card .card-header h6 {
    color: #495057;
    font-weight: 600;
    font-size: 18px;
}

.referrals-card .card-body {
    padding: 24px;
}

/* Three Column Layout */
.referrals-columns-container {
    display: flex;
    gap: 0;
    height: 100%;
    width: 100%;
}

.referrals-column {
    flex: 1;
    display: flex;
    flex-direction: column;
    border-right: 1px solid #e9ecef;
    min-height: 500px;
    position: relative;
    width: 33.333%;
}

.referrals-column:last-child {
    border-right: none;
}

.column-header {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border-bottom: 1px solid #dee2e6;
    padding: 16px 20px;
    margin: -24px 0 20px 0;
    border-radius: 0;
    width: 100%;
    box-sizing: border-box;
}

.column-title {
    color: #495057;
    font-weight: 600;
    font-size: 16px;
    margin: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    width: 100%;
}

.column-content {
    flex: 1;
    padding: 0 20px 0 12px;
    overflow-y: auto;
    max-height: 60vh;
    margin-right: -24px;
    padding-right: 20px;
}

.referrals-column:last-child .column-content {
    padding-right: 0;
    margin-right: 0;
}

/* Compact Referrals Sections */
.referrals-section-compact {
    margin-bottom: 20px;
    padding-right: 8px;
}

.section-title-compact {
    color: #495057;
    font-weight: 600;
    font-size: 14px;
    margin: 0 0 12px 0;
    display: flex;
    align-items: center;
}

/* Referrals Summary */
.referrals-summary-compact {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.summary-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px;
    background: white;
    border: 1px solid #e9ecef;
    border-radius: 8px;
    transition: all 0.2s ease;
}

.summary-item:hover {
    border-color: #adb5bd;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.summary-icon {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 14px;
    flex-shrink: 0;
}

.summary-icon.success {
    background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
}

.summary-icon.warning {
    background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);
}

.summary-icon.primary {
    background: linear-gradient(135deg, #007bff 0%, #6f42c1 100%);
}

.summary-details {
    flex: 1;
    min-width: 0;
}

.summary-amount {
    font-weight: 600;
    color: #495057;
    margin: 0 0 2px 0;
    font-size: 16px;
}

.summary-label {
    color: #6c757d;
    font-size: 12px;
    margin: 0;
}

/* Activity List */
.activity-list-compact {
    display: flex;
    flex-direction: column;
    gap: 8px;
    max-height: 200px;
    overflow-y: auto;
}

.activity-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px;
    background: white;
    border: 1px solid #e9ecef;
    border-radius: 6px;
    transition: all 0.2s ease;
}

.activity-item:hover {
    border-color: #adb5bd;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.activity-icon {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 12px;
    flex-shrink: 0;
}

.activity-icon.success {
    background: #28a745;
}

.activity-icon.pending {
    background: #ffc107;
}

.activity-icon.failed {
    background: #dc3545;
}

.activity-details {
    flex: 1;
    min-width: 0;
}

.activity-amount {
    font-weight: 600;
    color: #495057;
    margin: 0 0 2px 0;
    font-size: 14px;
}

.activity-date {
    color: #6c757d;
    font-size: 11px;
    margin: 0;
}

.activity-status {
    flex-shrink: 0;
}

/* Referral Link Container */
.referral-link-container {
    margin-bottom: 16px;
}

.referral-link-container .input-group {
    margin-bottom: 8px;
}

.referral-link-container .form-control {
    font-size: 13px;
    padding: 8px 12px;
}

.referral-link-container .btn {
    font-size: 13px;
    padding: 8px 12px;
}

/* Quick Actions */
.quick-actions-compact {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.quick-actions-compact .btn {
    font-size: 13px;
    padding: 10px 16px;
    border-radius: 6px;
    font-weight: 600;
    transition: all 0.2s ease;
}

.quick-actions-compact .btn-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border: none;
    color: white;
}

.quick-actions-compact .btn-primary:hover {
    background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
    transform: none;
    box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
}

.quick-actions-compact .btn-outline-primary {
    border-color: #667eea;
    color: #667eea;
}

.quick-actions-compact .btn-outline-primary:hover {
    background: #667eea;
    border-color: #667eea;
    color: white;
}

.quick-actions-compact .btn-outline-secondary {
    border-color: #6c757d;
    color: #6c757d;
}

.quick-actions-compact .btn-outline-secondary:hover {
    background: #6c757d;
    border-color: #6c757d;
    color: white;
}

/* Referral Code Display */
.referral-code-display {
    text-align: center;
}

.code-container {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    padding: 12px;
    background: white;
    border: 2px dashed #dee2e6;
    border-radius: 8px;
    margin-bottom: 8px;
    transition: all 0.2s ease;
}

.code-container:hover {
    border-color: #adb5bd;
    background: #f8f9fa;
}

.referral-code-text {
    font-family: 'Courier New', monospace;
    font-weight: 700;
    font-size: 16px;
    color: #007bff;
    letter-spacing: 1px;
}

.code-container .btn {
    font-size: 12px;
    padding: 4px 8px;
    border-radius: 4px;
}

/* History List */
.history-list-compact {
    display: flex;
    flex-direction: column;
    gap: 8px;
    max-height: 200px;
    overflow-y: auto;
}

/* Performance Stats */
.performance-stats-compact {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.stat-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 12px;
    background: white;
    border-radius: 6px;
    border: 1px solid #e9ecef;
    transition: all 0.2s ease;
}

.stat-item:hover {
    border-color: #adb5bd;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.stat-label {
    font-size: 12px;
    color: #6c757d;
    font-weight: 500;
}

.stat-value {
    font-size: 14px;
    font-weight: 700;
    color: #495057;
}

/* Tips */
.tips-compact {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.tip-item {
    display: flex;
    align-items: flex-start;
    gap: 8px;
    padding: 10px;
    background: white;
    border-radius: 6px;
    border: 1px solid #e9ecef;
    transition: all 0.2s ease;
}

.tip-item:hover {
    border-color: #adb5bd;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.tip-item small {
    color: #6c757d;
    line-height: 1.4;
    font-size: 12px;
}

/* Empty State */
.empty-state-compact {
    text-align: center;
    padding: 40px 20px;
    color: #6c757d;
}

.empty-icon-compact {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 16px;
    font-size: 24px;
    color: #adb5bd;
}

.empty-state-compact h6 {
    color: #495057;
    font-weight: 600;
    margin-bottom: 8px;
    font-size: 14px;
}

.empty-state-compact p {
    margin-bottom: 16px;
    font-size: 12px;
    line-height: 1.4;
}

/* Responsive Design */
@media (max-width: 768px) {
    .referrals-columns-container {
        flex-direction: column;
    }
    
    .referrals-column {
        border-right: none;
        border-bottom: 1px solid #e9ecef;
        min-height: auto;
    }
    
    .referrals-column:last-child {
        border-bottom: none;
    }
    
    .column-content {
        padding-right: 0;
        max-height: none;
    }
    
    .referrals-summary-compact {
        flex-direction: row;
        overflow-x: auto;
        gap: 8px;
    }
    
    .summary-item {
        min-width: 200px;
        flex-shrink: 0;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Fade in content
    const content = document.getElementById('referrals-content');
    setTimeout(() => {
        content.style.opacity = '1';
    }, 100);
    
    // Copy referral link functionality
    document.getElementById('copy-referral-link').addEventListener('click', function() {
        const linkInput = document.getElementById('referral-link');
        linkInput.select();
        linkInput.setSelectionRange(0, 99999);
        
        try {
            document.execCommand('copy');
            showNotification('Referral link copied to clipboard!', 'success');
        } catch (err) {
            showNotification('Failed to copy link', 'error');
        }
    });
    
    // Copy referral code functionality
    document.getElementById('copy-referral-code').addEventListener('click', function() {
        const codeText = '{{ current_user.referral_code or "" }}';
        
        if (navigator.clipboard) {
            navigator.clipboard.writeText(codeText).then(() => {
                showNotification('Referral code copied to clipboard!', 'success');
            }).catch(() => {
                showNotification('Failed to copy code', 'error');
            });
        } else {
            // Fallback for older browsers
            const textArea = document.createElement('textarea');
            textArea.value = codeText;
            document.body.appendChild(textArea);
            textArea.select();
            try {
                document.execCommand('copy');
                showNotification('Referral code copied to clipboard!', 'success');
            } catch (err) {
                showNotification('Failed to copy code', 'error');
            }
            document.body.removeChild(textArea);
        }
    });
    
    // Share via email
    document.getElementById('share-email').addEventListener('click', function() {
        const referralLink = document.getElementById('referral-link').value;
        const subject = 'Join me on Droply - Expert Consultation Platform';
        const body = `Hi! I've been using Droply, an amazing platform for expert consultations, and I thought you might be interested. You can book sessions with experts in various fields, and it's really easy to use.

Check it out: ${referralLink}

If you sign up and make your first booking, we both get $10! 

Let me know what you think!`;
        
        const mailtoLink = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
        window.open(mailtoLink);
    });
    
    // Share on social media
    document.getElementById('share-social').addEventListener('click', function() {
        const referralLink = document.getElementById('referral-link').value;
        const text = 'Check out Droply - an amazing platform for expert consultations! Join me and get $10 when you make your first booking.';
        
        // Create a simple share modal
        const shareModal = document.createElement('div');
        shareModal.className = 'modal fade';
        shareModal.innerHTML = `
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Share on Social Media</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <p>Share this link on your social media:</p>
                        <div class="input-group mb-3">
                            <input type="text" class="form-control" value="${referralLink}" readonly>
                            <button class="btn btn-outline-secondary" type="button" onclick="navigator.clipboard.writeText('${referralLink}')">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                        <div class="d-grid gap-2">
                            <a href="https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(referralLink)}" 
                               target="_blank" class="btn btn-primary">
                                <i class="fab fa-twitter me-2"></i>Share on Twitter
                            </a>
                            <a href="https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(referralLink)}" 
                               target="_blank" class="btn btn-primary">
                                <i class="fab fa-facebook me-2"></i>Share on Facebook
                            </a>
                            <a href="https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(referralLink)}" 
                               target="_blank" class="btn btn-primary">
                                <i class="fab fa-linkedin me-2"></i>Share on LinkedIn
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        document.body.appendChild(shareModal);
        const modal = new bootstrap.Modal(shareModal);
        modal.show();
        
        shareModal.addEventListener('hidden.bs.modal', function() {
            document.body.removeChild(shareModal);
        });
    });
    
    // Generate new referral code
    document.getElementById('generate-new-code').addEventListener('click', function() {
        if (confirm('Are you sure you want to generate a new referral code? Your old code will no longer work.')) {
            fetch('/api/referrals/generate-code', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    location.reload();
                } else {
                    showNotification('Failed to generate new code', 'error');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('Failed to generate new code', 'error');
            });
        }
    });
    
    // Load referral history and activity
    loadReferralData();
});

function loadReferralData() {
    // Load referral history and stats
    Promise.all([
        fetch('/api/referrals/history'),
        fetch('/api/referrals/stats')
    ])
    .then(responses => Promise.all(responses.map(r => r.json())))
    .then(([historyData, statsData]) => {
        if (historyData.success) {
            updateReferralHistory(historyData.referrals);
            updateReferralActivity(historyData.referrals);
        }
        if (statsData.success) {
            updatePerformanceStats(statsData.stats);
        }
    })
    .catch(error => {
        console.error('Error loading referral data:', error);
        showEmptyStates();
    });
}

function updateReferralHistory(referrals) {
    const historyList = document.getElementById('referral-history-list');
    
    if (!referrals || referrals.length === 0) {
        historyList.innerHTML = `
            <div class="empty-state-compact">
                <div class="empty-icon-compact">
                    <i class="fas fa-users"></i>
                </div>
                <h6>No Referrals Yet</h6>
                <p>Your referral history will appear here once friends start signing up.</p>
            </div>
        `;
        return;
    }
    
    const historyHTML = referrals.map(referral => `
        <div class="activity-item">
            <div class="activity-icon ${referral.status === 'completed' ? 'success' : 'pending'}">
                <i class="fas fa-${referral.status === 'completed' ? 'check' : 'clock'}"></i>
            </div>
            <div class="activity-details">
                <h6 class="activity-amount">${referral.referred_user_name || 'Anonymous'}</h6>
                <p class="activity-date">${new Date(referral.created_at).toLocaleDateString()}</p>
            </div>
            <div class="activity-status">
                <span class="badge bg-${referral.status === 'completed' ? 'success' : 'warning'}">
                    ${referral.status === 'completed' ? 'Earned $10' : 'Pending'}
                </span>
            </div>
        </div>
    `).join('');
    
    historyList.innerHTML = historyHTML;
}

function updateReferralActivity(referrals) {
    const activityList = document.getElementById('referral-activity-list');
    
    if (!referrals || referrals.length === 0) {
        activityList.innerHTML = `
            <div class="empty-state-compact">
                <div class="empty-icon-compact">
                    <i class="fas fa-chart-line"></i>
                </div>
                <h6>No Activity</h6>
                <p>Recent referral activity will appear here.</p>
            </div>
        `;
        return;
    }
    
    // Show last 3 referrals as activity
    const recentReferrals = referrals.slice(0, 3);
    const activityHTML = recentReferrals.map(referral => `
        <div class="activity-item">
            <div class="activity-icon ${referral.status === 'completed' ? 'success' : 'pending'}">
                <i class="fas fa-${referral.status === 'completed' ? 'check' : 'clock'}"></i>
            </div>
            <div class="activity-details">
                <h6 class="activity-amount">${referral.status === 'completed' ? '$10.00' : 'Pending'}</h6>
                <p class="activity-date">${new Date(referral.created_at).toLocaleDateString()}</p>
            </div>
        </div>
    `).join('');
    
    activityList.innerHTML = activityHTML;
}

function updatePerformanceStats(stats) {
    const conversionRate = stats.total_referrals > 0 ? 
        Math.round((stats.completed_referrals / stats.total_referrals) * 100) : 0;
    document.getElementById('conversion-rate').textContent = `${conversionRate}%`;
    document.getElementById('monthly-referrals').textContent = stats.completed_referrals || 0;
    document.getElementById('best-month').textContent = stats.total_referrals || 0;
}

function showEmptyStates() {
    document.getElementById('referral-history-list').innerHTML = `
        <div class="empty-state-compact">
            <div class="empty-icon-compact">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <h6>Unable to Load</h6>
            <p>There was an error loading your referral data.</p>
        </div>
    `;
    
    document.getElementById('referral-activity-list').innerHTML = `
        <div class="empty-state-compact">
            <div class="empty-icon-compact">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <h6>Unable to Load</h6>
            <p>There was an error loading your activity.</p>
        </div>
    `;
}

function showNotification(message, type) {
    // Create notification element
    const notification = document.createElement('div');
    notification.className = `alert alert-${type === 'success' ? 'success' : 'danger'} alert-dismissible fade show position-fixed`;
    notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
    notification.innerHTML = `
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    document.body.appendChild(notification);
    
    // Auto remove after 3 seconds
    setTimeout(() => {
        if (notification.parentNode) {
            notification.remove();
        }
    }, 3000);
}
</script>
{% endblock %}