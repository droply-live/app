{% extends "base_signed_in.html" %}

{% block title %}Booking Confirmation - Droply{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="row justify-content-center">
    <div class="col-lg-6 col-md-8">
      <div class="card p-4" style="border-radius: 18px; background: #fff; box-shadow: 0 4px 24px 0 rgba(60,120,255,0.08);">
        <div class="text-center mb-4">
          <h3 class="fw-bold">Booking Confirmation</h3>
          <p class="text-muted">Please review your booking details and proceed to payment</p>
        </div>

        <!-- Expert Info -->
        <div class="d-flex align-items-center mb-4 p-3" style="background: #f8f9fa; border-radius: 12px;">
          <img src="{{ user.profile_picture or url_for('static', filename='img/default-avatar.png') }}" 
               alt="{{ user.full_name }}" 
               class="rounded-circle me-3" 
               style="width: 60px; height: 60px; object-fit: cover;">
          <div>
            <h5 class="mb-1">{{ user.full_name or user.username }}</h5>
            <p class="text-muted mb-0">{{ user.profession|title if user.profession else 'Professional' }}</p>
          </div>
        </div>

        <!-- Booking Details -->
        <div class="mb-4">
          <h6 class="fw-bold mb-3">Booking Details</h6>
          <div class="row">
            <div class="col-6">
              <div class="mb-2">
                <small class="text-muted">Date</small>
                <div class="fw-bold">{{ booking_date }}</div>
              </div>
            </div>
            <div class="col-6">
              <div class="mb-2">
                <small class="text-muted">Time</small>
                <div class="fw-bold">{{ booking_time }}</div>
              </div>
            </div>
            <div class="col-6">
              <div class="mb-2">
                <small class="text-muted">Duration</small>
                <div class="fw-bold">{{ duration }} minutes</div>
              </div>
            </div>
            <div class="col-6">
              <div class="mb-2">
                <small class="text-muted">Session Type</small>
                <div class="fw-bold">Video Call</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Pricing -->
        <div class="mb-4 p-3" style="background: #f8f9fa; border-radius: 12px;">
          <h6 class="fw-bold mb-3">Pricing</h6>
          <div class="d-flex justify-content-between mb-2">
            <span>Session Fee ({{ duration }} min)</span>
            <span>${{ session_fee }}</span>
          </div>
          <div class="d-flex justify-content-between mb-2">
            <span>Platform Fee</span>
            <span>${{ platform_fee }}</span>
          </div>
          <hr>
          <div class="d-flex justify-content-between fw-bold">
            <span>Total</span>
            <span>${{ total_amount }}</span>
          </div>
        </div>

        <!-- Payment Form -->
        <form method="POST" action="{{ url_for('booking_confirmation', user=request.args.get('user'), datetime=request.args.get('datetime'), duration=request.args.get('duration')) }}">
          <div class="text-center">
            <button type="submit" class="btn btn-primary btn-lg px-5" id="pay-now-btn" style="border-radius: 12px;">
              <i data-feather="credit-card" class="me-2"></i>
              Pay Now - ${{ total_amount }}
            </button>
            <div class="mt-2">
              <small class="text-muted">You'll be redirected to complete your payment</small>
            </div>
          </div>
        </form>

        <!-- Cancellation Policy -->
        <div class="mt-4 p-3" style="background: #fff3cd; border-radius: 12px; border: 1px solid #ffeaa7;">
          <h6 class="fw-bold mb-2">Cancellation Policy</h6>
          <p class="small mb-0">
            You can cancel your booking up to 24 hours before the scheduled time for a full refund. 
            Cancellations within 24 hours may be subject to a cancellation fee.
          </p>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
document.addEventListener('DOMContentLoaded', function() {
  feather.replace();
  
  // Debug: Check if form exists
  const form = document.querySelector('form');
  const payButton = document.getElementById('pay-now-btn');
  
  console.log('Form found:', !!form);
  console.log('Pay button found:', !!payButton);
  
  if (payButton) {
    payButton.addEventListener('click', function(e) {
      console.log('Pay button clicked!');
      console.log('Form action:', form ? form.action : 'No form');
      console.log('Form method:', form ? form.method : 'No form');
      
      // Add loading state
      payButton.disabled = true;
      payButton.innerHTML = '<i data-feather="loader" class="me-2"></i>Processing...';
      feather.replace();
    });
  }
  
  if (form) {
    form.addEventListener('submit', function(e) {
      console.log('Form submitting...');
      console.log('Form data:', new FormData(form));
    });
  }
});
</script>
{% endblock %} 