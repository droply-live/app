{% extends "base_signed_in.html" %}

{% block title %}Profile Editor - Droply{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/profile-editor-new.css') }}">
{% endblock %}

{% block content %}
<div class="profile-editor-page">
    <div class="editor-container">
        <!-- Left Panel: Form Interface -->
        <div class="form-panel">
            <div class="panel-header">
                <h3>Profile Settings</h3>
            </div>
            
            <!-- Tab Navigation -->
            <div class="tab-nav">
                <button class="tab-btn active" onclick="switchTab('basic')">
                    <i class="fas fa-user"></i> Basic Info
                </button>
                <button class="tab-btn" onclick="switchTab('appearance')">
                    <i class="fas fa-palette"></i> Appearance
                </button>
                <button class="tab-btn" onclick="switchTab('content')">
                    <i class="fas fa-folder"></i> Content
                </button>
            </div>
            
            <!-- Tab Content -->
            <div class="tab-content">
                <!-- Basic Info Tab -->
                <div id="basic-tab" class="tab-panel active">
                    <div class="form-section">
                        <h4>Profile Images</h4>
                        <div class="form-group">
                            <label>Profile Picture</label>
                            <div class="image-upload" onclick="document.getElementById('profileImageUpload').click()">
                                <div class="upload-preview">
                                    {% if current_user.profile_picture %}
                                        <img id="profileImagePreview" src="{{ current_user.profile_picture }}" alt="Profile">
                                    {% else %}
                                        <div class="upload-placeholder">
                                            <i class="fas fa-camera"></i>
                                            <p>Upload photo</p>
                                        </div>
                                    {% endif %}
                                </div>
                                <input type="file" id="profileImageUpload" accept="image/*" style="display: none;" onchange="handleImageUpload(this)">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-section">
                        <h4>Personal Information</h4>
                        <div class="form-group">
                            <label>Full Name</label>
                            <input type="text" id="fullName" value="{{ current_user.full_name or '' }}" placeholder="Your full name">
                        </div>
                        <div class="form-group">
                            <label>Profession/Title</label>
                            <input type="text" id="profession" value="{{ current_user.profession or '' }}" placeholder="e.g., Software Engineer">
                        </div>
                        <div class="form-group">
                            <label>Bio/About</label>
                            <textarea id="bio" rows="3" placeholder="Tell us about yourself...">{{ current_user.bio or '' }}</textarea>
                        </div>
                        <div class="form-group">
                            <label>Location</label>
                            <input type="text" id="location" value="{{ current_user.location or '' }}" placeholder="Your location">
                        </div>
                    </div>
                </div>
                
                <!-- Appearance Tab -->
                <div id="appearance-tab" class="tab-panel">
                    <div class="form-section">
                        <h4>Color Scheme</h4>
                        <div class="form-group">
                            <label>Primary Color</label>
                            <input type="color" id="primaryColor" value="{{ current_user.primary_color or '#667eea' }}">
                        </div>
                        <div class="form-group">
                            <label>Secondary Color</label>
                            <input type="color" id="secondaryColor" value="{{ current_user.secondary_color or '#764ba2' }}">
                        </div>
                        <div class="form-group">
                            <label>Background Color</label>
                            <input type="color" id="backgroundColor" value="{{ current_user.background_color or '#f7faff' }}">
                        </div>
                    </div>
                </div>
                
                <!-- Content Tab -->
                <div id="content-tab" class="tab-panel">
                    <div class="form-section">
                        <h4>Services</h4>
                        <div class="form-group">
                            <label>Service Description</label>
                            <textarea id="serviceDescription" rows="3" placeholder="Describe your 1-on-1 sessions...">{{ current_user.service_description or '' }}</textarea>
                        </div>
                        <div class="form-group">
                            <label>Session Duration (minutes)</label>
                            <input type="number" id="sessionDuration" value="{{ current_user.session_duration or 30 }}" min="15" max="120">
                        </div>
                        <div class="form-group">
                            <label>Hourly Rate ($)</label>
                            <input type="number" id="hourlyRate" value="{{ current_user.hourly_rate or 0 }}" min="0" step="0.01">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Right Panel: Live Preview -->
        <div class="preview-panel">
            <div class="panel-header">
                <h3>Live Preview</h3>
                <div class="preview-controls">
                    <button class="preview-btn active" onclick="switchPreview('desktop')">
                        <i class="fas fa-desktop"></i> Desktop
                    </button>
                    <button class="preview-btn" onclick="switchPreview('mobile')">
                        <i class="fas fa-mobile-alt"></i> Mobile
                    </button>
                </div>
            </div>
            
            <div class="preview-content">
                <div id="desktop-preview" class="preview-frame">
                    <div class="profile-preview" id="profilePreview">
                        <!-- Preview content will be generated here -->
                    </div>
                </div>
                <div id="mobile-preview" class="preview-frame" style="display: none;">
                    <div class="profile-preview mobile" id="profilePreviewMobile">
                        <!-- Mobile preview content will be generated here -->
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Simple JavaScript for the new layout
let currentTab = 'basic';
let currentPreview = 'desktop';

function switchTab(tabName) {
    // Update tab buttons
    document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');
    
    // Update tab panels
    document.querySelectorAll('.tab-panel').forEach(panel => panel.classList.remove('active'));
    document.getElementById(tabName + '-tab').classList.add('active');
    
    currentTab = tabName;
    updatePreview();
}

function switchPreview(previewType) {
    document.querySelectorAll('.preview-btn').forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');
    
    document.getElementById('desktop-preview').style.display = previewType === 'desktop' ? 'block' : 'none';
    document.getElementById('mobile-preview').style.display = previewType === 'mobile' ? 'block' : 'none';
    
    currentPreview = previewType;
    updatePreview();
}

function updatePreview() {
    const fullName = document.getElementById('fullName')?.value || 'Your Name';
    const profession = document.getElementById('profession')?.value || 'Professional';
    const bio = document.getElementById('bio')?.value || 'Tell us about yourself...';
    const location = document.getElementById('location')?.value || 'Your Location';
    const serviceDescription = document.getElementById('serviceDescription')?.value || 'Book a personal session with me';
    const sessionDuration = document.getElementById('sessionDuration')?.value || 30;
    const hourlyRate = document.getElementById('hourlyRate')?.value || 0;
    const primaryColor = document.getElementById('primaryColor')?.value || '#667eea';
    const secondaryColor = document.getElementById('secondaryColor')?.value || '#764ba2';
    const backgroundColor = document.getElementById('backgroundColor')?.value || '#f7faff';
    const profileImage = document.getElementById('profileImagePreview')?.src || '/static/img/default-avatar.svg';
    
    const previewHTML = `
        <div class="profile-container" style="background: ${backgroundColor}; min-height: 100vh;">
            <!-- Profile Header -->
            <div class="profile-header" style="background: linear-gradient(135deg, ${primaryColor} 0%, ${secondaryColor} 100%); color: white; padding: 2rem; text-align: center;">
                <div class="profile-image-container" style="margin-bottom: 1rem;">
                    <img src="${profileImage}" 
                         alt="${fullName}" 
                         style="width: 120px; height: 120px; border-radius: 50%; object-fit: cover; border: 4px solid rgba(255, 255, 255, 0.3);">
                </div>
                
                <h1 style="margin: 0 0 0.5rem 0; font-size: 2rem; font-weight: 700;">${fullName}</h1>
                ${profession ? `<p style="margin: 0 0 0.5rem 0; opacity: 0.9; font-size: 1.1rem;">${profession}</p>` : ''}
                ${location ? `<p style="margin: 0 0 1rem 0; opacity: 0.8; font-size: 1rem;">
                    <i class="fas fa-map-marker-alt"></i> ${location}
                </p>` : ''}
                
                <!-- Social Media Icons -->
                <div style="display: flex; justify-content: center; gap: 1rem; margin-top: 1rem;">
                    <a href="#" style="color: white; font-size: 1.5rem; opacity: 0.8; transition: opacity 0.2s;">
                        <i class="fab fa-linkedin"></i>
                    </a>
                    <a href="#" style="color: white; font-size: 1.5rem; opacity: 0.8; transition: opacity 0.2s;">
                        <i class="fab fa-twitter"></i>
                    </a>
                    <a href="#" style="color: white; font-size: 1.5rem; opacity: 0.8; transition: opacity 0.2s;">
                        <i class="fab fa-github"></i>
                    </a>
                </div>
            </div>

            <!-- Profile Content Grid -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; padding: 2rem; max-width: 1200px; margin: 0 auto;">
                <!-- Left Column: About & Skills -->
                <div>
                    <!-- About Section -->
                    ${bio ? `
                    <div style="background: #2a2a2a; border-radius: 12px; padding: 1.5rem; margin-bottom: 1.5rem;">
                        <h2 style="color: white; margin: 0 0 1rem 0; font-size: 1.25rem; font-weight: 600;">About Me</h2>
                        <div style="color: #e2e8f0; line-height: 1.6;">
                            <p style="margin: 0;">${bio}</p>
                        </div>
                    </div>
                    ` : ''}

                    <!-- Portfolio Section -->
                    <div style="background: #2a2a2a; border-radius: 12px; padding: 1.5rem;">
                        <h2 style="color: white; margin: 0 0 1rem 0; font-size: 1.25rem; font-weight: 600;">Portfolio</h2>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem;">
                            <div style="background: #1a1a1a; border-radius: 8px; padding: 1rem; text-align: center; color: #9ca3af;">
                                <i class="fas fa-image" style="font-size: 2rem; margin-bottom: 0.5rem; display: block;"></i>
                                <span style="font-size: 0.9rem;">Coming Soon</span>
                            </div>
                            <div style="background: #1a1a1a; border-radius: 8px; padding: 1rem; text-align: center; color: #9ca3af;">
                                <i class="fas fa-video" style="font-size: 2rem; margin-bottom: 0.5rem; display: block;"></i>
                                <span style="font-size: 0.9rem;">Video Content</span>
                            </div>
                            <div style="background: #1a1a1a; border-radius: 8px; padding: 1rem; text-align: center; color: #9ca3af;">
                                <i class="fas fa-file-alt" style="font-size: 2rem; margin-bottom: 0.5rem; display: block;"></i>
                                <span style="font-size: 0.9rem;">Case Studies</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Column: Services & Booking -->
                <div>
                    <!-- Services Section -->
                    <div style="background: #2a2a2a; border-radius: 12px; padding: 1.5rem; margin-bottom: 1.5rem;">
                        <div style="margin-bottom: 1.5rem;">
                            <h2 style="color: white; margin: 0; font-size: 1.25rem; font-weight: 600;">Services & Pricing</h2>
                        </div>
                        
                        <div style="background: #1a1a1a; border-radius: 8px; padding: 1rem; margin-bottom: 1rem;">
                            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 0.5rem;">
                                <div style="background: #10b981; color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                                    <i class="fas fa-video"></i>
                                </div>
                                <div>
                                    <h3 style="color: white; margin: 0; font-size: 1rem; font-weight: 600;">1-on-1 Consultation</h3>
                                    <p style="color: #9ca3af; margin: 0; font-size: 0.9rem;">${serviceDescription}</p>
                                </div>
                            </div>
                            <div style="text-align: right;">
                                <span style="color: #10b981; font-size: 1.5rem; font-weight: 700;">$${hourlyRate}</span>
                                <span style="color: #9ca3af; font-size: 0.9rem;">/session</span>
                            </div>
                        </div>

                        <!-- Tip Jar -->
                        <div style="background: #1a1a1a; border-radius: 8px; padding: 1rem;">
                            <h3 style="color: white; margin: 0 0 0.5rem 0; font-size: 1rem; font-weight: 600;">Support My Work</h3>
                            <p style="color: #9ca3af; margin: 0 0 1rem 0; font-size: 0.9rem;">Buy me a coffee to support my content creation</p>
                            <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                                <button style="background: #10b981; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; font-size: 0.9rem; cursor: pointer;">$5</button>
                                <button style="background: #10b981; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; font-size: 0.9rem; cursor: pointer;">$10</button>
                                <button style="background: #10b981; color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; font-size: 0.9rem; cursor: pointer;">$25</button>
                                <button style="background: transparent; color: #10b981; border: 1px solid #10b981; padding: 0.5rem 1rem; border-radius: 6px; font-size: 0.9rem; cursor: pointer;">Custom</button>
                            </div>
                        </div>
                    </div>

                    <!-- Booking Section -->
                    <div style="background: #2a2a2a; border-radius: 12px; padding: 1.5rem; margin-bottom: 1.5rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                            <h2 style="color: white; margin: 0; font-size: 1.25rem; font-weight: 600;">Book a Session</h2>
                            <div style="display: flex; align-items: center; gap: 0.5rem; color: #10b981; font-size: 0.9rem;">
                                <i class="fas fa-circle" style="font-size: 0.5rem;"></i>
                                <span>Available Now</span>
                            </div>
                        </div>
                        
                        <button style="background: #10b981; color: white; border: none; padding: 1rem; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: pointer; width: 100%; display: flex; align-items: center; justify-content: center; gap: 0.5rem; margin-bottom: 1rem;">
                            <i class="fas fa-calendar-plus"></i>
                            <span>Book Now - $${hourlyRate}</span>
                        </button>
                        
                        <div style="text-align: center;">
                            <p style="color: #9ca3af; margin: 0; font-size: 0.9rem; display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                                <i class="fas fa-shield-alt"></i>
                                Secure payment • Cancel anytime
                            </p>
                        </div>
                    </div>

                    <!-- Testimonials Section -->
                    <div style="background: #2a2a2a; border-radius: 12px; padding: 1.5rem;">
                        <h2 style="color: white; margin: 0 0 1rem 0; font-size: 1.25rem; font-weight: 600;">What People Say</h2>
                        <div style="background: #1a1a1a; border-radius: 8px; padding: 1rem;">
                            <div style="margin-bottom: 1rem;">
                                <p style="color: #e2e8f0; margin: 0; font-style: italic;">"Amazing session! Really helped me understand the concepts I was struggling with."</p>
                            </div>
                            <div style="display: flex; align-items: center; gap: 0.75rem;">
                                <div style="background: #10b981; color: white; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 0.9rem; font-weight: 600;">JS</div>
                                <div>
                                    <span style="color: white; font-size: 0.9rem; font-weight: 600;">John Smith</span>
                                    <div style="color: #fbbf24; font-size: 0.8rem; margin-top: 0.25rem;">
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                        <i class="fas fa-star"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    const previewElement = currentPreview === 'mobile' ? 
        document.getElementById('profilePreviewMobile') : 
        document.getElementById('profilePreview');
    
    if (previewElement) {
        previewElement.innerHTML = previewHTML;
    }
}

function handleImageUpload(input) {
    const file = input.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const preview = document.getElementById('profileImagePreview');
            if (preview) {
                preview.src = e.target.result;
            } else {
                const placeholder = document.querySelector('.upload-placeholder');
                placeholder.innerHTML = `<img src="${e.target.result}" alt="Profile" style="max-width: 100%; max-height: 200px; border-radius: 8px;">`;
            }
            updatePreview();
        };
        reader.readAsDataURL(file);
    }
}

// Debounced update function to prevent excessive updates while typing
let updateTimeout;
function debouncedUpdatePreview() {
    clearTimeout(updateTimeout);
    updateTimeout = setTimeout(updatePreview, 50);
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
    updatePreview();
    
    // Add event listeners to all form fields for immediate updates
    const formFields = ['fullName', 'profession', 'bio', 'location', 'serviceDescription', 'sessionDuration', 'hourlyRate', 'primaryColor', 'secondaryColor', 'backgroundColor'];
    formFields.forEach(fieldId => {
        const element = document.getElementById(fieldId);
        if (element) {
            // Use debounced updates for text fields to prevent excessive updates
            if (fieldId === 'fullName' || fieldId === 'profession' || fieldId === 'bio' || fieldId === 'location' || fieldId === 'serviceDescription') {
                element.addEventListener('input', debouncedUpdatePreview);
            } else {
                // Immediate updates for color pickers and numbers
                element.addEventListener('input', updatePreview);
            }
            element.addEventListener('change', updatePreview);
        }
    });
});
</script>
{% endblock %}
